<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.2 -->
    <script>
        window.materialVersion = "1.5.2"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">














    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            离线与同步 | 
        
        XibHe&#39;s Blog
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="爱苹果,爱生活。">
    <meta name="keywords" content="null,数据同步">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?MKetZV3cUTfDxvMffaOezg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/tranquil-heart.min.css?ul3p9I9MsbOxK0L+BHzDDg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="XibHe&#39;s Blog">
    <meta name="msapplication-starturl" content="http://XibHe.github.io/2018/10/25/OffLineWithSync/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="XibHe&#39;s Blog">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://XibHe.github.io/2018/10/25/OffLineWithSync/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="离线与同步 | XibHe&#39;s Blog">
    <meta property="og:image" content="/img/favicon.png">
    <meta property="og:description" content="爱苹果,爱生活。">
    <meta property="og:article:tag" content="数据同步"> 

    
        <meta property="article:published_time" content="Thu Oct 25 2018 00:00:00 GMT+0800">
        <meta property="article:modified_time" content="Mon Nov 05 2018 14:13:35 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://XibHe.github.io/2018/10/25/OffLineWithSync/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://XibHe.github.io/2018/10/25/OffLineWithSync/index.html",
    "headline": "离线与同步",
    "datePublished": "Thu Oct 25 2018 00:00:00 GMT+0800",
    "dateModified": "Mon Nov 05 2018 14:13:35 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "XibHe",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.jpg"
        },
        "description": "It is never too late，Just do it better."
    },
    "publisher": {
        "@type": "Organization",
        "name": "XibHe&#39;s Blog",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",数据同步null",
    "description": "爱苹果,爱生活。",
}
</script>


    

    <!-- Analytics -->
    
    
        <script>
    var _hmt = _hmt || [];
    (function() {var hm = document.createElement('script');
    hm.src = 'https://hm.baidu.com/hm.js?919ef00558a82bb0e224f917f84d3124';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>

    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#支持离线模式的模块"><span class="post-toc-number">1.</span> <span class="post-toc-text">支持离线模式的模块</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#离线业务的具体步骤"><span class="post-toc-number">2.</span> <span class="post-toc-text">离线业务的具体步骤</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-监听当前设备所处的网络状态？"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">1. 监听当前设备所处的网络状态？</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-使用LZNetworkAvailability测试网络连接状态"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2. 使用LZNetworkAvailability测试网络连接状态</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-为确保您数据的准确性，请尽快恢复设备的网络连接"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">3. 为确保您数据的准确性，请尽快恢复设备的网络连接!</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#离线数据在有网环境下的同步"><span class="post-toc-number">3.</span> <span class="post-toc-text">离线数据在有网环境下的同步</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#数据同步遇到的一些问题"><span class="post-toc-number">4.</span> <span class="post-toc-text">数据同步遇到的一些问题</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#后续的优化"><span class="post-toc-number">5.</span> <span class="post-toc-text">后续的优化</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#写在最后"><span class="post-toc-number">6.</span> <span class="post-toc-text">写在最后</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#参考资料"><span class="post-toc-number">7.</span> <span class="post-toc-text">参考资料</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        <!-- Custom Thumbnail -->
        <div class="post_thumbnail-custom mdl-card__media mdl-color-text--grey-50" style="background-image:url(https://xibhe.oss-cn-beijing.aliyuncs.com/OffLineWithSync_thumbnail.jpg)">
    
            <p class="article-headline-p">
                离线与同步
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.jpg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>XibHe</strong>
        <span>10月 25, 2018</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">devices other</i>
    <span class="visuallyhidden">devices other</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
    <li class="mdl-menu__item">在其它设备中阅读本文章</li>
    
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACZElEQVR42u3a0W7DIAwF0Pz/T2+vk7bSaxMIqw5PVZoEHyqBa7i+PrpdeHh4eHh4eHh4h/GuuP1+6o9Xv7j/VV/jdzZjw8PDw9vCezPVBveMA8oH4ueVXmx4eHh4O3mvwsq7HN9ZxVRjw8PDwzuZ17uS9JjfiYeHh/e/eFFqGzDy8gQeHh7embw8Ue49Vb3zgVoLHh4eXszLp+z9n7fu7+Hh4eEFvPKRppu2uJI3NCPEw8PDW8zLJ+IetVd06MWDh4eHt4c3s/Gflwzy7a7qYlNIqfHw8PBu5VWLEdEEPZ0uNw9+4eHh4S3m9abgXorcS7LLRRA8PDy8xbwkga4WaueT9d5xKzw8PLxnefNp93iBSQ5y5Ww8PDy8nbzeoavqt+MUOS9nlBcGPDw8vMW85NV5cjwPGP8MhTIuHh4e3q28PI2uFnDz4PLFJipt4OHh4W3hVUsGvcNSyeZWdXDx8PDwnuUlU/ldRwp6/SZFZzw8PLzVvMKf/PzY000Fjt4BAjw8PLzVvBzTG5SkpFs9iPCmLzw8PLzFvF5SOxNcYYrvXcHDw8PbyKumsHlKPVP8LQ83Hh4e3kZetZQwv1U2P3B4eHh45/Bmpu8xptpjebjx8PDwFvOqbZwozz+VH9vCw8PDe4p3xS0JZWYx6H2OUmo8PDy8BbzqtJ6n4/nykA9leWHAw8PDW8abL7Am5dres/lw4OHh4Z3Mq6bd88WLKFnHw8PDO5iXlCGq1N5w4OHh4T3FS6bpMSwJvbrMlBN0PDw8vC28agmguhjMvCdZQvDw8PB28j6v4eHh4eHh4eHhHdC+ATLozko5sq+cAAAAAElFTkSuQmCC">
    
</ul>

    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/数据同步/">数据同步</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=离线与同步&url=http://XibHe.github.io/2018/10/25/OffLineWithSync/index.html&pic=http://XibHe.github.io/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=离线与同步&url=http://XibHe.github.io/2018/10/25/OffLineWithSync/index.html&via=XibHe" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://XibHe.github.io/2018/10/25/OffLineWithSync/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=XibHe&#39;s Blog&title=离线与同步&summary=爱苹果,爱生活。&pics=http://XibHe.github.io/img/favicon.png&url=http://XibHe.github.io/2018/10/25/OffLineWithSync/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>在弱网环境下，将要面对一些问题：频繁请求网络造成请求超时；完全没有网络导致请求失败。那么，针对这种特殊而又普遍的现象，需要做一些额外的功能去弥补弱网环境<br>下的操作体验。于是，针对某些重要功能的离线模式就诞生了！</p>
<p>离线功能是为了满足用户在较短时间断网<font color="55ff">（离线时间最长支持15天）</font>或无法访问服务器的情况下，可以正常的进行部分业务开展；从而保证对核心业务不会造成较大影响。</p>
<h3 id="支持离线模式的模块"><a href="#支持离线模式的模块" class="headerlink" title="支持离线模式的模块"></a>支持离线模式的模块</h3><ol>
<li>登录</li>
<li>看病开方<ul>
<li>新增处方支持离线</li>
<li>处方列表支持离线</li>
</ul>
</li>
<li>零售卖药<ul>
<li>新增售药单支持离线</li>
<li>售药列表支持离线</li>
</ul>
</li>
<li>患者管理<ul>
<li>新增患者支持离线</li>
<li>患者管理支持离线</li>
</ul>
</li>
<li>药房管理<ul>
<li>新增药品支持离线</li>
<li>药品管理支持离线</li>
</ul>
</li>
<li>我的<ul>
<li>诊所管理支持离线</li>
<li>系统设置支持离线</li>
<li>账号设置支持离线</li>
</ul>
</li>
</ol>
<h3 id="离线业务的具体步骤"><a href="#离线业务的具体步骤" class="headerlink" title="离线业务的具体步骤"></a>离线业务的具体步骤</h3><h4 id="1-监听当前设备所处的网络状态？"><a href="#1-监听当前设备所处的网络状态？" class="headerlink" title="1. 监听当前设备所处的网络状态？"></a>1. 监听当前设备所处的网络状态？</h4><p>离线模式切换所经历的三个过程：</p>
<ol>
<li>提示用户 “失去网络连接，3秒后重试”，之后进入 “网络连接中…” 状态；</li>
<li>如果重试3次均失败，提示用户 “重新连接失败，进入离线状态”；</li>
<li>1秒后，提示信息变更为 “因当前网络不可用，您已进入离线状态；离线状态只可使用部分功能！”。</li>
</ol>
<p>离线状态切换的三种状态，</p>
<pre><code class="objectivec">typedef NS_ENUM(NSInteger,offlineNetType) {
    Off_line,//离线
    In_the_Internet,//联网中
    Network_retry//联网重试
};
</code></pre>
<p>监听当前网络的连接状态，若此时未发现可靠网络连接或网络连接失败，则需要经历以上三个阶段，进行离线模式的转换。具体监听步骤如下：</p>
<ol>
<li>增加一个单利，并在单利中声明一个 BOOL 值的属性；</li>
</ol>
<pre><code class="objectivec">@interface Singleton : NSObject

@property(nonatomic,assign)BOOL hasNet;//是否有网络

@end
</code></pre>
<p>初始化时设置该属性默认值为 YES,</p>
<pre><code class="objectivec">
static Singleton *share = nil;

@interface Singleton()

@end

@implementation Singleton

- (instancetype)init
{
    self = [super init];
    if (self) {
        self.hasNet = YES;
    }
    return self;
}

+ (instancetype)shareInstance 
{
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
         share = [[Singleton alloc] init];
    });
    return share;
}

@end
</code></pre>
<ol>
<li>在工具类中增加判断网络</li>
</ol>
<p><em>SimplePing</em> 是苹果封装好的关于 <a href="https://zh.wikipedia.org/wiki/Ping" target="_blank" rel="external">ping</a> 的类，用于检测网络的连接状态。<em>SimplePing</em> 是一个封装低层级的 <em>BSD Sockets ping</em> 函数的类。使用这个类创建实例，设置委托然后调用 <em>-start</em> 方法开始在当前的 <em>run loop</em> (运行循环)中。如果顺利的话你很快就会得到 <em>-simplePing:didStartWithAddress:</em> 这个委托的回调。之后在这个回调里你就可以调用 <em>-sendPingWithData:</em> 来发送一个 <em>ping</em>，然后等待接收回调 <em>-simplePing:didReceivePingResponsePacket:sequenceNumber:</em> 和 <em>-simplePing:didReceiveUnexpectedPacket:</em></p>
<p>首先新建单利类 <em>LZNetworkAvailability</em>，在初始化方法中指定要 <em>ping</em> 的主机名称，</p>
<pre><code class="objectivec">static LZNetworkAvailability *share = nil;
@interface LZNetworkAvailability()&lt;SimplePingDelegate&gt;
@end

+ (void)shareInstanceNetworkAvailability{
    share = [[LZNetworkAvailability alloc] init];
}

-(instancetype)init{
    if (self = [super init]) {
            NSString *host = @&quot;usersystem.test.com&quot;;
            SimplePing *pinger = [[SimplePing alloc] initWithHostName:host];
            pinger.delegate = self;
            pinger.addressStyle = SimplePingAddressStyleAny;
            self.pinger = pinger;
            [self.pinger start];
    }
    return self;
}

@end
</code></pre>
<p>接下来实现 <em>SimplePing</em> 的代理方法，<em>SimplePingDelegate</em> 一共有6个方法，分别对应 <em>ping</em> 的不同状态：</p>
<pre><code class="objectivec">//开始进行网络检测
- (void)simplePing:(SimplePing *)pinger didStartWithAddress:(NSData *)address;
//网络检测失败
- (void)simplePing:(SimplePing *)pinger didFailWithError:(NSError *)error;
//发送网络包成功
- (void)simplePing:(SimplePing *)pinger didSendPacket:(NSData *)packet sequenceNumber:(uint16_t)sequenceNumber;
//发送网络包失败
- (void)simplePing:(SimplePing *)pinger didFailToSendPacket:(NSData *)packet sequenceNumber:(uint16_t)sequenceNumber error:(NSError *)error;
//收到网络包回应
- (void)simplePing:(SimplePing *)pinger didReceivePingResponsePacket:(NSData *)packet sequenceNumber:(uint16_t)sequenceNumber;
//收到错误的网络包
- (void)simplePing:(SimplePing *)pinger didReceiveUnexpectedPacket:(NSData *)packet;
</code></pre>
<p>然后分别在开始进行网络检测和网络检测失败的代理方法中设置单利类 <em>Singleton</em> 中 <em>hasNet</em> 属性的值，</p>
<pre><code class="objectivec">/**
 *  start成功，也就是准备工作做完后的回调
 */
- (void)simplePing:(SimplePing *)pinger didStartWithAddress:(NSData *)address
{
    // 发送测试报文数据
    [self.pinger sendPingWithData:nil];

    Singleton *sin = [Singleton shareInstance];
    if (!sin.hasNet) {
        sin.hasNet = YES;
        [[NSNotificationCenter defaultCenter] postNotificationName:networkCanBeUsedNotification object:nil];
    }
}
</code></pre>
<p>网络检测失败,</p>
<pre><code>//网络检测失败
- (void)simplePing:(SimplePing *)pinger didFailWithError:(NSError *)error
{
    NSLog(@&quot;didFailWithError&quot;);
    [self.pinger stop];
    Singleton *sin = [Singleton shareInstance];
    sin.hasNet = YES;
    if (sin.isOverdue) {
        if ([[UIViewController getCurrentVC] isKindOfClass:[[LZMediator sharedInstance] LZLoginComponents_loginViewController].class] || [[UIViewController getCurrentVC] isKindOfClass:[[LZMediator sharedInstance] LZLoginComponents_forgetPwdViewController].class]) {
            if (sin.hasNet) {
                sin.hasNet = NO;
                [[NSNotificationCenter defaultCenter] postNotificationName:networkCanNotUsedNotification object:nil];
            }
            return;
        }
        LZCustomAlertView *alertView = [[LZCustomAlertView alloc] initWithTitle:@&quot;温馨提示&quot; content:@&quot;很抱歉，过期诊所不可进入离线模式&quot; close:nil certain:@&quot;我知道了&quot; closeButtonBlock:nil certainButtonBlock:^(LZCustomAlertView *alertView) {
            [LZMainHandler loginOutInitRemovePwd:NO backToLogin:YES];
            if (sin.hasNet) {
                sin.hasNet = NO;
                [[NSNotificationCenter defaultCenter] postNotificationName:networkCanNotUsedNotification object:nil];
            }
        }];
        [alertView show];
    }else{
        if (sin.hasNet) {
            sin.hasNet = NO;
            [[NSNotificationCenter defaultCenter] postNotificationName:networkCanNotUsedNotification object:nil];
        }
    }

}
</code></pre><h4 id="2-使用LZNetworkAvailability测试网络连接状态"><a href="#2-使用LZNetworkAvailability测试网络连接状态" class="headerlink" title="2. 使用LZNetworkAvailability测试网络连接状态"></a>2. 使用LZNetworkAvailability测试网络连接状态</h4><p>基于 <em>SimplePing</em> 的 <em>LZNetworkAvailability</em> 类可以在任何线程上使用，但是用作单例必须限制在指定的开启运行循环的线程。由于在应用程序启动时，就需要实现网络的检测，所有，在 <em>AppDelegate</em> 里进行初始化，</p>
<pre><code class="objectivec">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    //开始网络检测
    [LZNetworkAvailability shareInstanceNetworkAvailability];
}
</code></pre>
<p><strong><font color="55ff">注意：</font></strong><br>这里需要特别注意的一点，网络请求会存在失败的情况，而网络连接问题同样会导致请求失败。这里就需要对这种情况失败情况进行检测，在封装的网络请求方法中，调用 <em>shareInstanceNetworkAvailability</em> 进行检测，</p>
<pre><code class="objectivec">//基本请求接口，是否发送token失效通知
+ (void)baseRequestWithParam:(NSDictionary *)param
                        path:(NSString *)path
                      method:(LZHttpRequestType)method
                loseEfficacy:(BOOL)loseEfficacy
                     success:(void(^)(LZHttpResponseModel *responseModel))success
                     failure:(void(^)(NSError *error))failure{
    [[LZHttpClient defaultClient] requestWithPath:path method:method parameters:[self getDetailDicWithParam:param] prepareExecute:^{

    } success:^(AFHTTPRequestOperation *operation, id responseObject) {
        LZHttpResponseModel *model = [LZHttpResponseModel mj_objectWithKeyValues:responseObject];
        NSLog(@&quot;\n****************response***********:\n%@\n *******************url************:\n%@ \n*****************param**********\n%@&quot;,responseObject,operation.request.URL,param);

        if ([model.body.code isKindOfClass:[NSString class]] &amp;&amp; ![model.body.code isEqualToString:SUCCESS_CODE] &amp;&amp; ![model.body.code isEqualToString:SUCCESS_CODE_NEW] &amp;&amp; ![model.body.code isEqualToString:@&quot;0330&quot;] &amp;&amp; ![model.body.code isEqualToString:@&quot;0336&quot;] &amp;&amp; ![model.body.code isEqualToString:@&quot;0798&quot;]) {
        }
        if (success) {
            success(model);
        }
    } failure:^(AFHTTPRequestOperation *operation, NSError *error) {
        Class class = NSClassFromString(@&quot;LZNetworkAvailability&quot;);
        BeginUndeclaredSelectorWarning
        [class performSelector:@selector(shareInstanceNetworkAvailability) withObject:nil];
        EndUndeclaredSelectorWarning
        if (failure) {
            failure(error);
        }
    }];
}
</code></pre>
<p>这里通过 <em>NSClassFromString</em> 找到动态加载的类，直接调用类中的方法。</p>
<h4 id="3-为确保您数据的准确性，请尽快恢复设备的网络连接"><a href="#3-为确保您数据的准确性，请尽快恢复设备的网络连接" class="headerlink" title="3. 为确保您数据的准确性，请尽快恢复设备的网络连接!"></a>3. 为确保您数据的准确性，请尽快恢复设备的网络连接!</h4><p>离线数据的保存最长时间是多少？</p>
<p>离线登录需要判断离线时间，并给出提示？</p>
<h3 id="离线数据在有网环境下的同步"><a href="#离线数据在有网环境下的同步" class="headerlink" title="离线数据在有网环境下的同步"></a>离线数据在有网环境下的同步</h3><p>利用 <em>GCD</em> 中的 <em>dispatch_semaphore</em> 即，信号量来实现不同模块数据的同步。</p>
<p><em>GCD</em> 中的信号量是指 <em>Dispatch Semaphore</em>，是持有计数的信号。类似于过高速路收费站的栏杆。可以通过时，打开栏杆，不可以通过时，关闭栏杆。在 <em>Dispatch Semaphore</em> 中，使用计数来完成这个功能，计数为0时等待，不可通过。计数为1或大于1时，计数减1且不等待，可通过。<em>Dispatch Semaphore</em> 提供了三个函数。</p>
<p>离线数据上传，</p>
<pre><code class="objectivec">#pragma mark - 离线数据上传
- (void)offLineAllDataUploadWithSync:(BOOL)sync {

    //每次上传都需要新创建一个数组来保存成功返回的流水号
    NSMutableArray *serialNumberMuArr = [[NSMutableArray alloc]init];
    [LZUserDefaults setObject:serialNumberMuArr forKey:PreferenceKey_OffLine_SerialNumberMuArr];

    //保存一个开关
    [LZUserDefaults setObject:@&quot;0&quot; forKey:PreferenceKey_OffLine_OfflineUploadComplete];

    //顺序执行 信号量
    dispatch_semaphore_t sem = dispatch_semaphore_create(1);
    dispatch_queue_t queue = dispatch_queue_create(&quot;OfflineDrugReductionInventoryoffLineAllDataUpload&quot;, NULL);
    dispatch_async(queue, ^{
        dispatch_semaphore_wait(sem, DISPATCH_TIME_FOREVER);
        NSLog(@&quot;WX患者模块&quot;);
        [self offLineNetWorkWithType:@&quot;CP&quot; withSem:sem];
//        dispatch_semaphore_signal(sem);
    });
    if (sync) {
        dispatch_async(queue, ^{
            dispatch_semaphore_wait(sem, DISPATCH_TIME_FOREVER);
            NSLog(@&quot;WX设置模块&quot;);
            [self offLineNetWorkWithType:@&quot;CE&quot; withSem:sem];
            //        dispatch_semaphore_signal(sem);
        });
    }
    dispatch_async(queue, ^{
        dispatch_semaphore_wait(sem, DISPATCH_TIME_FOREVER);
        NSLog(@&quot;WX处方模块&quot;);
        [self offLineNetWorkWithType:@&quot;RP&quot; withSem:sem];
//        dispatch_semaphore_signal(sem);
    });
    dispatch_async(queue, ^{
        dispatch_semaphore_wait(sem, DISPATCH_TIME_FOREVER);
        NSLog(@&quot;WX零售模块&quot;);
        [self offLineNetWorkWithType:@&quot;RS&quot; withSem:sem];
//        dispatch_semaphore_signal(sem);
    });
    dispatch_async(queue, ^{
        dispatch_semaphore_wait(sem, DISPATCH_TIME_FOREVER);
        NSLog(@&quot;WX预约挂号&quot;);
        [self offLineNetWorkWithType:@&quot;RE&quot; withSem:sem];
        //        dispatch_semaphore_signal(sem);
    });
    dispatch_async(queue, ^{
        dispatch_semaphore_wait(sem, DISPATCH_TIME_FOREVER);
        NSLog(@&quot;WX数据上传完毕&quot;);
        [LZUserDefaults setObject:@&quot;1&quot; forKey:PreferenceKey_OffLine_OfflineUploadComplete];

        if (sync) {
            [self queryResultFromBackStage];
        }else {
            dispatch_async(dispatch_get_main_queue(), ^{
                self.actionBlock();
            });
        }

        dispatch_semaphore_signal(sem);
    });

}
</code></pre>
<h3 id="数据同步遇到的一些问题"><a href="#数据同步遇到的一些问题" class="headerlink" title="数据同步遇到的一些问题"></a>数据同步遇到的一些问题</h3><p>成功请求一些编辑信息的接口后，会调用相应模块的同步接口。（这样做的利与弊？是否适用于每个数据同步操作？）</p>
<h3 id="后续的优化"><a href="#后续的优化" class="headerlink" title="后续的优化"></a>后续的优化</h3><p>现在生产上一半的问题是数据同步引起的，新的方案是引入第三方IM，诊所所有账户加入到聊天室，当数据产生并上传服务器成功后，发消息到聊天室，其他账户收到消息数据并处理。</p>
<h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h3><font color="55ff">未完，待续……</font>

<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a href="https://zh.wikipedia.org/wiki/Ping" target="_blank" rel="external">ping</a></p>
<p><a href="https://juejin.im/entry/5873407ea22b9d005898bd9b" target="_blank" rel="external">iOS-ping 网络小工具</a></p>
<p><a href="https://developer.apple.com/library/archive/samplecode/SimplePing/Introduction/Intro.html" target="_blank" rel="external">SimplePing</a></p>
<p>–EOF–</p>
<p>若无特别说明，本站文章均为原创，转载请保留链接，谢谢</p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 Gitalk -->
<div id="gitalk-comment">
    <!-- Gitalk 评论框 -->
<div id="gitalk-container"></div>

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<script>
    var gitalk = new Gitalk({
            clientID: '664d164a7c2910ff9c32',
            clientSecret: '312260816c7af1b87c16b13906b55270ba8a1736',
            repo: 'BlogGitalks',
            owner: 'xibhe',
            admin: ['xibhe'],
            // facebook-like distraction free mode
            distractionFreeMode: false,
            id: 'Thu Oct 25 2018 00:00:00 GMT+0800'
        })
   gitalk.render('gitalk-container')
</script>

</div>
<style>
    #gitalk-comment {
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2018/12/31/2018year-endsummary/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2018/08/10/RebuildFlagsSignaling/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.jpg);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.jpg" alt="XibHe's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        huahuaaihehe@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2019/03/">三月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/01/">一月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/12/">十二月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/10/">十月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/08/">八月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/07/">七月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/05/">五月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/04/">四月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">三月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/02/">二月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">十一月 2017<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">九月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">八月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">一月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">十二月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">八月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/01/">一月 2016<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/JavaScript/">JavaScript<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/Objective-C/">Objective-C<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/categories/功能/">功能<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/架构/">架构<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/解惑/">解惑<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/categories/设计模式/">设计模式<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/译文/">译文<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/categories/阅读/">阅读<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/随笔/">随笔<span class="sidebar_archives-count">8</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/quotes" title="引述">
                
                    <i class="material-icons sidebar-material-icons">star rate</i>
                
                引述
            </a>
        </li>
        
    
        <li>
            <a href="/tags" title="标签云">
                
                    <i class="material-icons sidebar-material-icons">search</i>
                
                标签云
            </a>
        </li>
        
    
        <li>
            <a href="/about" title="关于我">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                关于我
            </a>
        </li>
        
    
        <li>
            <a href="/links" title="友情链接">
                
                    <i class="material-icons sidebar-material-icons">link</i>
                
                友情链接
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/heheaihuahua" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/profile.php?id=100010683492211" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/xibhe" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;2016&nbsp;-<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>XibHe's Blog
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?V/53wGualMuiPM3xoetD5Q==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>









   <!-- GitTalk -->









<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.2 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
