<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.2 -->
    <script>
        window.materialVersion = "1.5.2"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">



    <link rel="dns-prefetch" href="https://busuanzi.ibruce.info"/>












    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            直播业务集成及再开发 | 
        
        XibHe&#39;s Blog
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="爱苹果,爱生活。">
    <meta name="keywords" content="null,直播,推拉流">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?MKetZV3cUTfDxvMffaOezg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/tranquil-heart.min.css?ul3p9I9MsbOxK0L+BHzDDg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="XibHe&#39;s Blog">
    <meta name="msapplication-starturl" content="http://XibHe.github.io/2021/06/12/直播业务集成及再开发/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="XibHe&#39;s Blog">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://XibHe.github.io/2021/06/12/直播业务集成及再开发/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="直播业务集成及再开发 | XibHe&#39;s Blog">
    <meta property="og:image" content="/img/favicon.png">
    <meta property="og:description" content="爱苹果,爱生活。">
    <meta property="og:article:tag" content="直播"> <meta property="og:article:tag" content="推拉流"> 

    
        <meta property="article:published_time" content="Sat Jun 12 2021 00:00:00 GMT+0800">
        <meta property="article:modified_time" content="Sat Jul 24 2021 18:21:09 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://XibHe.github.io/2021/06/12/直播业务集成及再开发/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://XibHe.github.io/2021/06/12/直播业务集成及再开发/index.html",
    "headline": "直播业务集成及再开发",
    "datePublished": "Sat Jun 12 2021 00:00:00 GMT+0800",
    "dateModified": "Sat Jul 24 2021 18:21:09 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "XibHe",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.jpg"
        },
        "description": "It is never too late，Just do it better."
    },
    "publisher": {
        "@type": "Organization",
        "name": "XibHe&#39;s Blog",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",直播,推拉流null",
    "description": "爱苹果,爱生活。",
}
</script>


    

    <!-- Analytics -->
    
    
        <script>
    var _hmt = _hmt || [];
    (function() {var hm = document.createElement('script');
    hm.src = 'https://hm.baidu.com/hm.js?919ef00558a82bb0e224f917f84d3124';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>

    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#直播技术点"><span class="post-toc-number">1.</span> <span class="post-toc-text">直播技术点</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#业务流程（观众端）"><span class="post-toc-number">2.</span> <span class="post-toc-text">业务流程（观众端）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#交互流程"><span class="post-toc-number">3.</span> <span class="post-toc-text">交互流程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-首先需要在-AppDelegate-中对腾讯云直播-SDK-和-IM-进行初始配置"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">1. 首先需要在 AppDelegate 中对腾讯云直播 SDK 和 IM 进行初始配置</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-通过首页-CMS-或短信链接或者微信分享的直播链接打开包含-roomId-信息的路由链接。直播间新增直播间对应路由-eg-XXX-activity-live-roomId-1234568"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">2. 通过首页 CMS 或短信链接或者微信分享的直播链接打开包含 roomId 信息的路由链接。直播间新增直播间对应路由 eg. XXX://activity/live?roomId=1234568</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-进入直播间调用获取房间详情接口获取直播间信息，根据接口返回的直播状态决定是拉流播放还是点播回放，并展示不同状态的-UI-样式。目前共有101、103、106、108、110、115、206-等-7-种状态。通过返回字段-pullUrl-获取直播拉流地址，若直播状态为-101-则则直接进行拉流播放；否则，根据不同状态展示不同-UI-视图。"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">3. 进入直播间调用获取房间详情接口获取直播间信息，根据接口返回的直播状态决定是拉流播放还是点播回放，并展示不同状态的 UI 样式。目前共有101、103、106、108、110、115、206 等 7 种状态。通过返回字段 pullUrl 获取直播拉流地址，若直播状态为 101 则则直接进行拉流播放；否则，根据不同状态展示不同 UI 视图。</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-已登录情况下，进入直播间三步走："><span class="post-toc-number">3.4.</span> <span class="post-toc-text">4. 已登录情况下，进入直播间三步走：</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#直播后台推流及状态"><span class="post-toc-number">4.</span> <span class="post-toc-text">直播后台推流及状态</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#直播-SDK-推流状态"><span class="post-toc-number">5.</span> <span class="post-toc-text">直播 SDK 推流状态</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#iOS-直播功能目录结构及对应类："><span class="post-toc-number">6.</span> <span class="post-toc-text">iOS 直播功能目录结构及对应类：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#直播推拉流"><span class="post-toc-number">7.</span> <span class="post-toc-text">直播推拉流</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#IM-普通消息及自定义消息体处理"><span class="post-toc-number">8.</span> <span class="post-toc-text">IM 普通消息及自定义消息体处理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-点赞"><span class="post-toc-number">8.1.</span> <span class="post-toc-text">1. 点赞</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-删除-（只删除-user-id-不是自己的他人发送的消息）"><span class="post-toc-number">8.2.</span> <span class="post-toc-text">2. 删除 （只删除 user_id 不是自己的他人发送的消息）</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#遗留问题"><span class="post-toc-number">9.</span> <span class="post-toc-text">遗留问题</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#注意事项"><span class="post-toc-number">10.</span> <span class="post-toc-text">注意事项</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#参考文档"><span class="post-toc-number">11.</span> <span class="post-toc-text">参考文档</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        <!-- Custom Thumbnail -->
        <div class="post_thumbnail-custom mdl-card__media mdl-color-text--grey-50" style="background-image:url(https://xibhe.oss-cn-beijing.aliyuncs.com/LitePlay/liteLive_thumbnail.jpg)">
    
            <p class="article-headline-p">
                直播业务集成及再开发
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.jpg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>XibHe</strong>
        <span>6月 12, 2021</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">devices other</i>
    <span class="visuallyhidden">devices other</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
    <li class="mdl-menu__item">在其它设备中阅读本文章</li>
    
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAAC5ElEQVR42u3b3W7CMAwGUN7/pbfbSWjhs023kpxeoYqGnCDN8w+PryOvBzY2NjY2NjY2NvYt2Y/4en7/zzvPa/72en1nfb+3Z2xsbOwT2C/+9C8Z660kR7MGJ6ut94yNjY19DjvZdDXUrdmTZ/M9Y2NjY2Ovg02SQuQHh42NjY39NwGsR5qA84CKjY2NfTI7L9DkpfzJe/LAeXktDRsbG/v27KsDzBWv/6G/jY2NjX1L9vxKEoNJQept+8TGxsbelJ23YKvDNPmoZZJm9BoP2NjY2Cewyw+Pi0f5Aa2/jPLBYWNjY2/KrjZQey2EPBXp3XlDfxsbGxv7Y9nrIFQNbL0wUw2ZeajDxsbGPoHdG2R8V0mol97kqQs2Njb2OexeWacaoiYBbNI2wMbGxt6bnQeM5GOS+8nBVQ8i+hqwsbGxN2VPtpUnKtXkoVdmav56ABsbG/vD2dWC+zqwFTZRXKea8GBjY2Ofw+4VcfLgMRkDqhaPyqkINjY29hbsJCT0yveTAtOk2DRqD2BjY2N/IDsfhZm3Y6vHsT7EcqMaGxsbe1N2NQ2olvUnKUqyTqFFgY2Njb0pOx+p7DVck0NM2L2ghY2NjX0aO08MJmWpSYoy2SE2Njb23uy8qJQnD71PqR5HPuKDjY2NvSu7Gniqg5K9dZKRnTxlwsbGxt6bnY9C9sr3Lwo949ZC3iTAxsbGPodd+Oc+PqzqU/k6hQIWNjY29tbsaik/D0i9MJkXjwpjmtjY2NgHsyfpSi8gXTGIiY2Njb0ru5cS9A5rMgxUbgasUxFsbGzsjdiP+Jo3dJMVklJU7yixsbGx92b3SkW9wv3VgaoQwLCxsbG3Y+eDkr0g1wtg1RD764FiY2NjYw82XX32DcjrAhg2Njb2h7N7TdlqS7iQYATHjY2NjX0OuxAM4gJ9VLgfj/hE97GxsbG3ZlcbvfkK1XCVD1MmDQlsbGzsE9jnXNjY2NjY2NjY2Ni3ub4B5lyHKTTvU44AAAAASUVORK5CYII=">
    
</ul>

    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/推拉流/">推拉流</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/直播/">直播</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    
        
    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=直播业务集成及再开发&url=http://XibHe.github.io/2021/06/12/直播业务集成及再开发/index.html&pic=http://XibHe.github.io/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=直播业务集成及再开发&url=http://XibHe.github.io/2021/06/12/直播业务集成及再开发/index.html&via=XibHe" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://XibHe.github.io/2021/06/12/直播业务集成及再开发/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=XibHe&#39;s Blog&title=直播业务集成及再开发&summary=爱苹果,爱生活。&pics=http://XibHe.github.io/img/favicon.png&url=http://XibHe.github.io/2021/06/12/直播业务集成及再开发/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>在项目中集成直播功能，提高运营端营销效率、下单转化率、增加营销方式并成为客户沉淀的重要手段。</p>
<h3 id="直播技术点"><a href="#直播技术点" class="headerlink" title="直播技术点"></a>直播技术点</h3><p>视频直播，可以分为 采集，前处理，编码，传输，解码，渲染 这几个环节。</p>
<ul>
<li>推流端：采集、前处理、编码、推流</li>
<li>服务端：转码、录制、截图、鉴黄</li>
<li>观众端（播放器）：拉流、解码、渲染</li>
<li>互动：聊天室、礼物系统、点赞、弹幕等</li>
</ul>
<p>直播技术点：</p>
<p><img src="https://xibhe.oss-cn-beijing.aliyuncs.com/LitePlay/liteLive_01.png" alt="直播技术点"></p>
<p>直播 App 架构：</p>
<p><img src="https://xibhe.oss-cn-beijing.aliyuncs.com/LitePlay/liteLive_02.png" alt="直播App架构"></p>
<h3 id="业务流程（观众端）"><a href="#业务流程（观众端）" class="headerlink" title="业务流程（观众端）"></a>业务流程（观众端）</h3><p>观众端拉流播放功能，基于腾讯云直播基础版（Smart），基础版仅包含直播推流（TXLivePusher）和直播播放（TXLivePlayer）两项功能，对 App 的安装包体积增量最小，适合仅使用移动直播相关功能的客户。</p>
<p><img src="https://xibhe.oss-cn-beijing.aliyuncs.com/LitePlay/liteLive_03.png" alt="直播间流程图"></p>
<p>直播间主要包含四部分功能：</p>
<ul>
<li>直播拉流播放功能</li>
<li>点播回放功能</li>
<li>IM 消息收发展示及处理特殊自定义消息</li>
<li>不同直播状态 UI 样式之间切换及展示</li>
</ul>
<h3 id="交互流程"><a href="#交互流程" class="headerlink" title="交互流程"></a>交互流程</h3><h4 id="1-首先需要在-AppDelegate-中对腾讯云直播-SDK-和-IM-进行初始配置"><a href="#1-首先需要在-AppDelegate-中对腾讯云直播-SDK-和-IM-进行初始配置" class="headerlink" title="1. 首先需要在 AppDelegate 中对腾讯云直播 SDK 和 IM 进行初始配置"></a>1. 首先需要在 AppDelegate 中对腾讯云直播 SDK 和 IM 进行初始配置</h4><pre><code class="objectivec">[TXLiveBase setLicenceURL:@&quot;&quot; key:@&quot;&quot;];
  // 腾讯云 IM SDK 初始化
  V2TIMSDKConfig *config = [[V2TIMSDKConfig alloc] init];
  BOOL isinitSDK = [[V2TIMManager sharedInstance] initSDK: config:config listener:nil];
  NSLog(@&quot;isinitSDK = %@&quot;, isinitSDK ? @&quot;YES&quot; : @&quot;NO&quot;);
</code></pre>
<h4 id="2-通过首页-CMS-或短信链接或者微信分享的直播链接打开包含-roomId-信息的路由链接。直播间新增直播间对应路由-eg-XXX-activity-live-roomId-1234568"><a href="#2-通过首页-CMS-或短信链接或者微信分享的直播链接打开包含-roomId-信息的路由链接。直播间新增直播间对应路由-eg-XXX-activity-live-roomId-1234568" class="headerlink" title="2. 通过首页 CMS 或短信链接或者微信分享的直播链接打开包含 roomId 信息的路由链接。直播间新增直播间对应路由 eg. XXX://activity/live?roomId=1234568"></a>2. 通过首页 CMS 或短信链接或者微信分享的直播链接打开包含 roomId 信息的路由链接。直播间新增直播间对应路由 eg. XXX://activity/live?roomId=1234568</h4><h4 id="3-进入直播间调用获取房间详情接口获取直播间信息，根据接口返回的直播状态决定是拉流播放还是点播回放，并展示不同状态的-UI-样式。目前共有101、103、106、108、110、115、206-等-7-种状态。通过返回字段-pullUrl-获取直播拉流地址，若直播状态为-101-则则直接进行拉流播放；否则，根据不同状态展示不同-UI-视图。"><a href="#3-进入直播间调用获取房间详情接口获取直播间信息，根据接口返回的直播状态决定是拉流播放还是点播回放，并展示不同状态的-UI-样式。目前共有101、103、106、108、110、115、206-等-7-种状态。通过返回字段-pullUrl-获取直播拉流地址，若直播状态为-101-则则直接进行拉流播放；否则，根据不同状态展示不同-UI-视图。" class="headerlink" title="3. 进入直播间调用获取房间详情接口获取直播间信息，根据接口返回的直播状态决定是拉流播放还是点播回放，并展示不同状态的 UI 样式。目前共有101、103、106、108、110、115、206 等 7 种状态。通过返回字段 pullUrl 获取直播拉流地址，若直播状态为 101 则则直接进行拉流播放；否则，根据不同状态展示不同 UI 视图。"></a>3. 进入直播间调用获取房间详情接口获取直播间信息，根据接口返回的直播状态决定是拉流播放还是点播回放，并展示不同状态的 UI 样式。目前共有101、103、106、108、110、115、206 等 7 种状态。通过返回字段 pullUrl 获取直播拉流地址，若直播状态为 101 则则直接进行拉流播放；否则，根据不同状态展示不同 UI 视图。</h4><h4 id="4-已登录情况下，进入直播间三步走："><a href="#4-已登录情况下，进入直播间三步走：" class="headerlink" title="4. 已登录情况下，进入直播间三步走："></a>4. 已登录情况下，进入直播间三步走：</h4><ul>
<li>调用接口 getUserSig 获取用户 Sig；</li>
<li>拿着获取到的用户 Sig 登录 IM ；</li>
<li>在 IM 登录成功后，调用加入直播间群组 API。</li>
</ul>
<p>⚠️在以上三步成功走完后，就可以在直播间发送文本消息或者自定义点赞消息了。</p>
<p><img src="https://xibhe.oss-cn-beijing.aliyuncs.com/LitePlay/liteLive_04.png" alt="交互流程图"></p>
<h3 id="直播后台推流及状态"><a href="#直播后台推流及状态" class="headerlink" title="直播后台推流及状态"></a>直播后台推流及状态</h3><p><img src="https://xibhe.oss-cn-beijing.aliyuncs.com/LitePlay/liteLive_05.png" alt="推流状态"></p>
<ul>
<li><p>103  暂停中(或异常): 若上一个状态为 106 待开播，则提示：主播正在赶来的路上，请稍候，否则，提示：主播暂时离开，请稍候。并展示“点击重试” 按钮。可以提过该按钮，触发重试拉流逻辑。</p>
</li>
<li><p>106 待开播，该状态展示开播倒计时（开播时间戳为xxx分钟xxx秒、xxx秒触发倒计时）及展示“开播提醒”按钮，点击会调用订阅及提醒接口 </p>
</li>
<li><p>108 已结束，回放生成中，展示已结束提示：“直播已结束”、“回放生成中” 并触发商品弹窗（固定位置且不可关闭）</p>
</li>
<li><p>110 云点播(回放)，根据回放地址播放视频，展示自定义播放进度控制条、商品按钮、分享</p>
</li>
<li><p>115 已结束，无回放。展示已结束提示：“直播已结束” 并触发商品弹窗（固定位置且不可关闭）</p>
</li>
<li><p>206 禁播。展示“主播暂时离开，请稍候”及 “看看其他直播”按钮。</p>
</li>
</ul>
<p>⚠️由状态 101 到 108 需要更新“xxxx人观看”视图，而直接为 108 不需要，即，展示“xxxx人观看”</p>
<h3 id="直播-SDK-推流状态"><a href="#直播-SDK-推流状态" class="headerlink" title="直播 SDK 推流状态"></a>直播 SDK 推流状态</h3><p>腾讯云直播</p>
<p><img src="https://xibhe.oss-cn-beijing.aliyuncs.com/LitePlay/liteLive_06.png" alt="腾讯云直播SDK状态"></p>
<p>拉流端异常处理：基于直播 SDK 状态码 2003、2004、2006、-2301 等对直播异常状态进行特殊处理。</p>
<ul>
<li>-2301 及其他导致连接失败的异常：此时，更新后台推流状态码为 103 暂停中(或异常) 触发异常逻辑</li>
</ul>
<pre><code class="objectivec">weakSelf.livePlayerWrapper.playErrorBlock = ^(int event, NSString *msg) {
    dispatch_async(dispatch_get_main_queue(), ^{
//      [weakSelf.livePlayer pause];
//      [MCToast hideLoadingToastInView:weakSelf.playToolBarView];
      [MCKitLoading mcStopLoadingInView:weakSelf.playToolBarView];
      // 暂停中(或异常)
      [weakSelf.livePlayer removeVideoWidget];
      [weakSelf.roomInfoDict mcSetInteger:103 forKey:@&quot;liveStatus&quot;];
      [weakSelf.playToolBarView handleRoomId:weakSelf.roomId roomInfo:weakSelf.roomInfoDict];
      [weakSelf.playToolBarView.liteStatusView configRetryTitle];

//      MCStrongSelf
//      weakSelf.playToolBarView.liteStatusView.retryBlock = ^{
////        [MCToast showLoadingToastInView:strongSelf.view];
//        NSString *pullUrl = [strongSelf.roomInfoDict mcObjectForKey:@&quot;pullUrl&quot;];
//        [strongSelf startPlayWithView:strongSelf.videoPlayerView pullUrl:pullUrl];
//      };
    });
  };
</code></pre>
<ul>
<li>2003、2004、2006 这三种状态，主要用来处理由播放异常到开始播放或者播放结束的过度状态。对应不同的服务端播放状态及 UI 处理逻辑。</li>
</ul>
<pre><code class="objectivec">// 播放事件回调
  weakSelf.livePlayerWrapper.playEventBlock = ^(int event, NSDictionary * _Nonnull param) {

    switch (event) {
      case EVT_RENDER_FIRST_I_FRAME: {
        // 渲染首个视频数据包（IDR）
        dispatch_async(dispatch_get_main_queue(), ^{
          [MCKitLoading mcStopLoadingInView:weakSelf.playToolBarView];
          [weakSelf.roomInfoDict mcSetInteger:101 forKey:@&quot;liveStatus&quot;];
          [weakSelf.playToolBarView handleRoomId:weakSelf.roomId roomInfo:weakSelf.roomInfoDict];
        });
      }
        break;
      case EVT_VIDEO_PLAY_BEGIN: {
        // 视频播放开始
        dispatch_async(dispatch_get_main_queue(), ^{
          [MCKitLoading mcStopLoadingInView:weakSelf.playToolBarView];
        });
      }
        break;

//      case EVT_VIDEO_PLAY_PROGRESS: {
//        // 视频播放进度
//        dispatch_async(dispatch_get_main_queue(), ^{
//          [MCKitLoading mcStopLoadingInView:weakSelf.playToolBarView];
//        });
//      }
//        break;;
      case EVT_VIDEO_PLAY_END: {
        // 视频播放结束
        dispatch_async(dispatch_get_main_queue(), ^{
          [MCKitLoading mcStopLoadingInView:weakSelf.playToolBarView];
          [weakSelf.roomInfoDict mcSetInteger:108 forKey:@&quot;liveStatus&quot;];
          [weakSelf.playToolBarView handleRoomId:weakSelf.roomId roomInfo:weakSelf.roomInfoDict];
        });
      }
        break;
      default:
        break;
    }
</code></pre>
<p>⚠️：原有直播开始回调逻辑，在从异常中断到再次连接开始播放过渡时，不是每次都百分百调用。因此，才需要在 playEventBlock 中处理多种过度状态。</p>
<h3 id="iOS-直播功能目录结构及对应类："><a href="#iOS-直播功能目录结构及对应类：" class="headerlink" title="iOS 直播功能目录结构及对应类："></a>iOS 直播功能目录结构及对应类：</h3><p>主要分为三部分：直播间管理类及IM 消息管理类、直播间控制器、直播不同状态 UI 视图。</p>
<ul>
<li>直播间管理类及 IM 消息管理类： XXX 主要处理直播间普通及自定义 IM 消息，包括 IM 登录、加入群组、普通或自定义消息接收及处理、群消息接收、收到强制关闭直播的消息 (1: 后台强制结束 2: 主播涉黄 3: 超时被强制结束 4: 超时未开播)、获取在线人数、退出直播间 (退出 IM 群组)、删除消息</li>
</ul>
<pre><code class="objectivec">// 收到强制关闭直播的消息 (1: 后台强制结束 2: 主播涉黄 3: 超时被强制结束)
- (void)onRecvRESTRoomID:(NSString *)roomID status:(int)status;
</code></pre>
<ul>
<li><p>观众播放主控制器，处理直播间不同的直播状态、IM 消息、监听主播端推流状态、配置直播间</p>
</li>
<li><p>View 目录下为直播间 UI：IM 消息列表、点赞、分享、商品等所在的观众播放页面工具视图（点赞、评论、分享、点播时的进度条）、顶部视图 （展示观看人数等信息)、直播状态视图、回到直播间悬浮、新的直播间商品弹窗等 UI 视图。</p>
</li>
</ul>
<h3 id="直播推拉流"><a href="#直播推拉流" class="headerlink" title="直播推拉流"></a>直播推拉流</h3><ol>
<li>推流端（主播端）小程序推</li>
<li>拉流端（观众端）</li>
</ol>
<p>基于腾讯云直播 SDK 的二次开发。</p>
<h3 id="IM-普通消息及自定义消息体处理"><a href="#IM-普通消息及自定义消息体处理" class="headerlink" title="IM 普通消息及自定义消息体处理"></a>IM 普通消息及自定义消息体处理</h3><p>&#124; 使用自定义消息体payload中的data字段来传输数据，data为字符串Json，约定cmd来做类型区分</p>
<p>eg.<br><img src="https://xibhe.oss-cn-beijing.aliyuncs.com/LitePlay/liteLive_07.png" alt="示例"></p>
<h4 id="1-点赞"><a href="#1-点赞" class="headerlink" title="1. 点赞"></a>1. 点赞</h4><ul>
<li>cmd: LIKE</li>
<li>num：当前点赞了几次</li>
</ul>
<blockquote>
<p>约定num字段来记录当前用户点赞点了几下，接收方会拿自己本地当前的点赞数累加该num</p>
</blockquote>
<h4 id="2-删除-（只删除-user-id-不是自己的他人发送的消息）"><a href="#2-删除-（只删除-user-id-不是自己的他人发送的消息）" class="headerlink" title="2. 删除 （只删除 user_id 不是自己的他人发送的消息）"></a>2. 删除 （只删除 user_id 不是自己的他人发送的消息）</h4><blockquote>
<p>由于小程序端消息体中的 messageId 与 iOS 及 Andriond 两端算法不一致，导致三端无法通过 messageId 删除特定消息体。因此，最后方案是：通过匹配字符串的方式，删除当前消息列表中的消息。</p>
</blockquote>
<ul>
<li>cmd: DELETE_MESSAGE</li>
<li>msg_text: 当前消息的文本</li>
<li>user_id: 当前消息体的发送方id</li>
</ul>
<p>IM 管理类 MCTXIMManager 中定义的消息体的不同 CMD，用以区分不同的自定义消息体</p>
<pre><code class="objectivec">#define CMD_PUSHER_CHANGE   @&quot;notifyPusherChange&quot;
#define CMD_CUSTOM_TEXT_MSG  @&quot;CustomTextMsg&quot;
#define CMD_CUSTOM_LIKE      @&quot;LIKE&quot;       // 点赞
#define CMD_DELETE_MESSAGE   @&quot;DELETE_MESSAGE&quot;  // 删除消息
#define CMD_LIVE_STATUS_NOTICE @&quot;LIVE_STATUS_NOTICE&quot; // 主播端主动通知的状态
</code></pre>
<h3 id="遗留问题"><a href="#遗留问题" class="headerlink" title="遗留问题"></a>遗留问题</h3><p>iOS、Andriond、小程序三端进入直播间获取的实时在线人数不一致的问题；</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol>
<li>iOS 集成腾讯云直播基础版，相比之下，直播专业版本继承了 <a href="https://cloud.tencent.com/product/trtc" target="_blank" rel="external">实时音视频 SDK</a>、<a href="https://cloud.tencent.com/product/player" target="_blank" rel="external">超级播放器（Player+）</a> 和 <a href="https://cloud.tencent.com/product/ugsv" target="_blank" rel="external">短视频（UGSV）</a>等音视频相关的核心功能。根据目前业务需求基础版完全够用了；</li>
<li>为避免 SDK 版本不一致导致功能性问题，iOS 与 Andriond 直播 SDK 版本固定为：pod ‘TXLiteAVSDK_Smart’, ‘8.7.10102’ 两端而 IM SDK 版本固定为： pod ‘TXIMSDK_iOS’, ‘5.1.62’；</li>
<li>TXIMSDK_iOS 中包含新旧两套 IM API，为了保证稳定性。iOS 和 Andriond 使用最新的 IM API。iOS 使用调用方法名以 V2TIMManager 为开头的新 API；</li>
<li>点播回放功能并没有集成腾讯单独提供的超级播放器(通过 pod ‘SuperPlayer’ 引入) 而是通过对TXLiteAVSDK_Smart 提供的 TXVodPlayer 点播播放器进行自定义。在 TXVodPlayer 基础之上按照 UI 设计稿样式自定义播放进度条实现；</li>
<li>未登录可以进入直播间，注意项目中未登录到登录状态的处理逻辑；</li>
<li>通过 CMS 列表商品从直播间跳转商品详情页的浮窗逻辑；</li>
<li>iOS 发布 App Store 需要经营范围包含“表演”或“网络表演”的<font color="#DC143C">《网络文化经营许可证》 </font></li>
</ol>
<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a href="https://cloud.tencent.com/document/product/454/7873" target="_blank" rel="external">腾讯云移动直播 SDK</a> </p>
<p><a href="https://cloud.tencent.com/document/product/269/1616" target="_blank" rel="external">即时通讯 IM</a></p>
<p><a href="https://im.sdk.qcloud.com/doc/zh-cn/interfaceV2TIMManager.html#a38c42943046acdaf615915c9422af07c" target="_blank" rel="external">IMSDK （V2TIMManager 版）</a></p>
<p><a href="https://cloud.tencent.com/document/product/269/44499#.E7.BE.A4.E7.BB.84.E7.9B.B8.E5.85.B3.E6.8E.A5.E5.8F.A3" target="_blank" rel="external">即时通讯客户端 SDK API</a></p>
<p>–EOF–</p>
<p>若无特别说明，本篇文章均为原创，转载请保留链接，谢谢！</p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 Gitalk -->
<div id="gitalk-comment">
    <!-- Gitalk 评论框 -->
<div id="gitalk-container"></div>

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<script>
    var gitalk = new Gitalk({
            clientID: '664d164a7c2910ff9c32',
            clientSecret: '312260816c7af1b87c16b13906b55270ba8a1736',
            repo: 'BlogGitalks',
            owner: 'xibhe',
            admin: ['xibhe'],
            // facebook-like distraction free mode
            distractionFreeMode: false,
            id: 'Sat Jun 12 2021 00:00:00 GMT+0800'
        })
   gitalk.render('gitalk-container')
</script>

</div>
<style>
    #gitalk-comment {
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2021/09/20/直播业务性能优化/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2020/08/31/Swift_OC_mix/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.jpg);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.jpg" alt="XibHe's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        huahuaaihehe@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2021/09/">九月 2021<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/06/">六月 2021<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/08/">八月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/05/">五月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/06/">六月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/05/">五月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/03/">三月 2019<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/01/">一月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/12/">十二月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/10/">十月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/08/">八月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/07/">七月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/05/">五月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/04/">四月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">三月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/02/">二月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">十一月 2017<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">九月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">八月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">一月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">十二月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">八月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/01/">一月 2016<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/JavaScript/">JavaScript<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/Objective-C/">Objective-C<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/categories/优化/">优化<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/功能/">功能<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/探索/">探索<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/日常/">日常<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/架构/">架构<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/解惑/">解惑<span class="sidebar_archives-count">16</span></a></li><li><a class="sidebar_archives-link" href="/categories/设计模式/">设计模式<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/译文/">译文<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/categories/阅读/">阅读<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/随笔/">随笔<span class="sidebar_archives-count">8</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/quotes" title="引述">
                
                    <i class="material-icons sidebar-material-icons">star rate</i>
                
                引述
            </a>
        </li>
        
    
        <li>
            <a href="/tags" title="标签云">
                
                    <i class="material-icons sidebar-material-icons">search</i>
                
                标签云
            </a>
        </li>
        
    
        <li>
            <a href="/about" title="关于我">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                关于我
            </a>
        </li>
        
    
        <li>
            <a href="/links" title="友情链接">
                
                    <i class="material-icons sidebar-material-icons">link</i>
                
                友情链接
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/heheaihuahua" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/profile.php?id=100010683492211" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/xibhe" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;2016&nbsp;-<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>XibHe's Blog
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?V/53wGualMuiPM3xoetD5Q==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>







    <!-- Busuanzi -->
    <script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



   <!-- GitTalk -->









<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.2 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
