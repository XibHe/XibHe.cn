<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.2 -->
    <script>
        window.materialVersion = "1.5.2"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">



    <link rel="dns-prefetch" href="https://busuanzi.ibruce.info"/>












    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            组件化初探 | 
        
        XibHe&#39;s Blog
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="爱苹果,爱生活。">
    <meta name="keywords" content="null,组件化">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?MKetZV3cUTfDxvMffaOezg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/tranquil-heart.min.css?ul3p9I9MsbOxK0L+BHzDDg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="XibHe&#39;s Blog">
    <meta name="msapplication-starturl" content="http://XibHe.github.io/2018/07/18/ModuleFirstExplore/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="XibHe&#39;s Blog">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://XibHe.github.io/2018/07/18/ModuleFirstExplore/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="组件化初探 | XibHe&#39;s Blog">
    <meta property="og:image" content="/img/favicon.png">
    <meta property="og:description" content="爱苹果,爱生活。">
    <meta property="og:article:tag" content="组件化"> 

    
        <meta property="article:published_time" content="Wed Jul 18 2018 00:00:00 GMT+0800">
        <meta property="article:modified_time" content="Sat Nov 23 2019 23:42:20 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://XibHe.github.io/2018/07/18/ModuleFirstExplore/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://XibHe.github.io/2018/07/18/ModuleFirstExplore/index.html",
    "headline": "组件化初探",
    "datePublished": "Wed Jul 18 2018 00:00:00 GMT+0800",
    "dateModified": "Sat Nov 23 2019 23:42:20 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "XibHe",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.jpg"
        },
        "description": "It is never too late，Just do it better."
    },
    "publisher": {
        "@type": "Organization",
        "name": "XibHe&#39;s Blog",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",组件化null",
    "description": "爱苹果,爱生活。",
}
</script>


    

    <!-- Analytics -->
    
    
        <script>
    var _hmt = _hmt || [];
    (function() {var hm = document.createElement('script');
    hm.src = 'https://hm.baidu.com/hm.js?919ef00558a82bb0e224f917f84d3124';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>

    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#更新说明"><span class="post-toc-number">1.</span> <span class="post-toc-text">更新说明</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#现在项目中存在的问题"><span class="post-toc-number">2.</span> <span class="post-toc-text">现在项目中存在的问题</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#期望达到的效果"><span class="post-toc-number">3.</span> <span class="post-toc-text">期望达到的效果</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#组件划分粒度及其相互间的依赖"><span class="post-toc-number">4.</span> <span class="post-toc-text">组件划分粒度及其相互间的依赖</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#MVC-VS-MVVM"><span class="post-toc-number">5.</span> <span class="post-toc-text">MVC VS MVVM</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#CoCoaPods-私有库"><span class="post-toc-number">6.</span> <span class="post-toc-text">CoCoaPods 私有库</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-使用模板快速创建测试工程（组件所在的工程）"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">1.使用模板快速创建测试工程（组件所在的工程）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-在-GitLab-上创建一个用来存放基础组件的仓库LZBasisComponents"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">2.在 GitLab 上创建一个用来存放基础组件的仓库LZBasisComponents</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-配置私有库的-podspec-文件"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">3.配置私有库的 .podspec 文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-将上面创建的模板工程，提交到-GitLab-上创建的远程代码仓库中"><span class="post-toc-number">6.4.</span> <span class="post-toc-text">4.将上面创建的模板工程，提交到 GitLab 上创建的远程代码仓库中</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-cd-到-模板工程所在的-Example-对应的私有库目录"><span class="post-toc-number">6.4.1.</span> <span class="post-toc-text">1. cd 到 模板工程所在的 Example 对应的私有库目录</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-可以先查看当前工程文件的状态，红色为未提交"><span class="post-toc-number">6.4.2.</span> <span class="post-toc-text">2. 可以先查看当前工程文件的状态，红色为未提交</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-提交到暂缓区"><span class="post-toc-number">6.4.3.</span> <span class="post-toc-text">3. 提交到暂缓区</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-将本地库与远程代码仓库进行关联"><span class="post-toc-number">6.4.4.</span> <span class="post-toc-text">4. 将本地库与远程代码仓库进行关联</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5-初始化提交"><span class="post-toc-number">6.4.5.</span> <span class="post-toc-text">5. 初始化提交</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#6-将本地分支的更新，推送到远程主机"><span class="post-toc-number">6.4.6.</span> <span class="post-toc-text">6. 将本地分支的更新，推送到远程主机</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-给远程组件库打-tag"><span class="post-toc-number">6.4.7.</span> <span class="post-toc-text">7. 给远程组件库打 tag</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-主工程中使用-CoCoaPods-导入私有组件库"><span class="post-toc-number">6.5.</span> <span class="post-toc-text">5.主工程中使用 CoCoaPods 导入私有组件库</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#组件之间及各组件与主工程间通讯-中间件"><span class="post-toc-number">7.</span> <span class="post-toc-text">组件之间及各组件与主工程间通讯(中间件)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#新增基于-CTMediator-的组件-LZMediator"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">新增基于 CTMediator 的组件 LZMediator</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#新建与其它组件通讯的中间件"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">新建与其它组件通讯的中间件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#在中间件中新增用于通讯的-LZMediator-类别"><span class="post-toc-number">7.3.</span> <span class="post-toc-text">在中间件中新增用于通讯的 LZMediator 类别</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#在-target-action-所在的组件中增加提供服务的类"><span class="post-toc-number">7.4.</span> <span class="post-toc-text">在 target-action 所在的组件中增加提供服务的类</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#在其它组件中调用中间件的方法进行通讯"><span class="post-toc-number">7.5.</span> <span class="post-toc-text">在其它组件中调用中间件的方法进行通讯</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#原工程中资源文件的处理"><span class="post-toc-number">8.</span> <span class="post-toc-text">原工程中资源文件的处理</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#受工期影响"><span class="post-toc-number">9.</span> <span class="post-toc-text">受工期影响</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#组件化过程中遇到的问题及解决方式"><span class="post-toc-number">10.</span> <span class="post-toc-text">组件化过程中遇到的问题及解决方式</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-duplicate-symbols-for-architecture-arm64"><span class="post-toc-number">10.1.</span> <span class="post-toc-text">1. duplicate symbols for architecture arm64</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-OBJC-CLASS-LZKanBingHomeViewController-referenced-from-objc-class-ref-in-libLZWorkTableComponents-a-LZWorkTableMangerController-o-ld-symbol-s-not-found-for-architecture-arm64-clang-error-linker-command-failed-with-exit-code-1-use-v-to-see-invocation"><span class="post-toc-number">10.2.</span> <span class="post-toc-text">2. _OBJC_CLASS_LZKanBingHomeViewController, referenced from: objc-class-ref in libLZWorkTableComponents.a(LZWorkTableMangerController.o) ld: symbol(s) not found for architecture arm64 clang: error: linker command failed with exit code 1 (use -v to see invocation)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-Property-‘text’-cannot-be-found-in-forward-class-object-‘PlaceholderTextView’Property-‘text’-cannot-be-found-in-forward-class-object-‘PlaceholderTextView’"><span class="post-toc-number">10.3.</span> <span class="post-toc-text">3. Property ‘text’ cannot be found in forward class object ‘PlaceholderTextView’Property ‘text’ cannot be found in forward class object ‘PlaceholderTextView’</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-GlobalMethod-showName-”请输入正确手机号码”-inView-self-headView-dianhuaView-不执行"><span class="post-toc-number">10.4.</span> <span class="post-toc-text">4. [GlobalMethod showName:@”请输入正确手机号码” inView:self.headView.dianhuaView] 不执行</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-暂时注释掉组件中跳转至其它组件控制器的方法"><span class="post-toc-number">10.5.</span> <span class="post-toc-text">5. 暂时注释掉组件中跳转至其它组件控制器的方法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6-Reference-to-‘LZHttpRequestPost’-is-ambiguous"><span class="post-toc-number">10.6.</span> <span class="post-toc-text">6. Reference to ‘LZHttpRequestPost’ is ambiguous</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-iOS-9-3-5-系统下，页面布局错乱的问题"><span class="post-toc-number">10.7.</span> <span class="post-toc-text">7. iOS 9.3.5 系统下，页面布局错乱的问题</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#8-Include-of-non-modular-header-inside-framework-module-‘LZBasisComponents-LZHttpClient’-‘-Users-zyjk-imac-penghe-Library-Developer-Xcode-DerivedData-CloudOffice-ffqipmpyrmrjqmevvpibbskoycre-Build-Products-Debug-iphoneos-AFNetworking-AFNetworking-framework-Headers-AFURLRequestSerialization-h’"><span class="post-toc-number">10.8.</span> <span class="post-toc-text">8. Include of non-modular header inside framework module ‘LZBasisComponents.LZHttpClient’: ‘/Users/zyjk_imac-penghe/Library/Developer/Xcode/DerivedData/CloudOffice-ffqipmpyrmrjqmevvpibbskoycre/Build/Products/Debug-iphoneos/AFNetworking/AFNetworking.framework/Headers/AFURLRequestSerialization.h’</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#9-组件间的依赖关系"><span class="post-toc-number">10.9.</span> <span class="post-toc-text">9. 组件间的依赖关系</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#10-如何将两个组件之间通过代理交互替换为通过中间件交互"><span class="post-toc-number">10.10.</span> <span class="post-toc-text">10. 如何将两个组件之间通过代理交互替换为通过中间件交互</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#写在最后"><span class="post-toc-number">11.</span> <span class="post-toc-text">写在最后</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#参考资料"><span class="post-toc-number">12.</span> <span class="post-toc-text">参考资料</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        <!-- Custom Thumbnail -->
        <div class="post_thumbnail-custom mdl-card__media mdl-color-text--grey-50" style="background-image:url(https://xibhe.oss-cn-beijing.aliyuncs.com/ModuleFirstExplore_headerThumbnail.jpg)">
    
            <p class="article-headline-p">
                组件化初探
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.jpg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>XibHe</strong>
        <span>7月 18, 2018</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">devices other</i>
    <span class="visuallyhidden">devices other</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
    <li class="mdl-menu__item">在其它设备中阅读本文章</li>
    
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAAC1UlEQVR42u3aQW4jMQwEQP//09lrLhl0i/LClmpOxsCRVcqBIFuvnyufFzY2NjY2NjY2NvZHsl/xEy3965vP6zy/T36l3TM2Njb22ewck/D++s7z52fehj1jY2NjX8CeA57fPP9KcsRre8bGxsbGnpSf/P1z6UqOGxsbGxu7ZU9KVzIket4nNjY2NvbagCY5lLbgJaHCWoSAjY2NfQ87D00/5/N/zbexsbGxP5jdPnnjMV85L1fR+tjY2NiHsts2IB8DPcMmlzLXLoliY2Njn8puxz3t4Ol5Q/n7vLD9+R4bGxv7MnZbYN7X0iQHF62DjY2NfSi7HrKXBSkpezmsbXuwsbGx72EnTUU79Jm0Fkn53FDAsLGxsQ9lr42Z1oKEtatCG4ZK2NjY2Aex80KVA/KSNomH86KLjY2NfRs7H+5MWpc2bNhQ2LCxsbGPZk9G/HmUu9bYtCF0FA9gY2NjH8eeR7wJKdniJHLYULexsbGxv5Cd8NqoYFJmkoNe+/dgY2Njn8re1XLMh1OThiRqqLCxsbGPZr8j4m0v9yRNUX5kRQeGjY2N/eXsyfXHvGFowbtGVNjY2Nj3sCelaG04tXagSTGrZ2nY2NjYX85uW4X2sIrxfRkV5Bc3sbGxsW9g5yFuMY4PAtq8EdpQULGxsbEPZW8IUINo4Wf85L9bxAPY2NjYx7HbQjKh5itMVsPGxsa+jZ03HrvamPyw5hd3sLGxsW9g5+Vq11byI1i7BoqNjY19A3s+3Hne9OTaTT7kSgohNjY29qnstcC1Heu0IcSkcBZDJWxsbOyD2GtDora1yNuJfOSUNyTY2NjYN7Dzraz97VrcO7msiY2NjY2dtxl5+9EOodpyNUpFsLGxsa9h51tvrwS1w6zkiLGxsbHvYbfhbhL9tldzkqKVlzpsbGzse9jt+H6tXckZ7Xfenm9jY2NjfzD7ngcbGxsbGxsbGxv7Y55/ZLGRA9AHbKQAAAAASUVORK5CYII=">
    
</ul>

    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/组件化/">组件化</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    
        
    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=组件化初探&url=http://XibHe.github.io/2018/07/18/ModuleFirstExplore/index.html&pic=http://XibHe.github.io/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=组件化初探&url=http://XibHe.github.io/2018/07/18/ModuleFirstExplore/index.html&via=XibHe" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://XibHe.github.io/2018/07/18/ModuleFirstExplore/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=XibHe&#39;s Blog&title=组件化初探&summary=爱苹果,爱生活。&pics=http://XibHe.github.io/img/favicon.png&url=http://XibHe.github.io/2018/07/18/ModuleFirstExplore/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>项目经过三年多的迭代，总共有三拨人接手，代码整体风格各异，迭代后的旧代码与新代码揉在一起，难解难分。各功能模块间相互依赖，头文件多次重复引用，编译一次大概花费5分钟。不得不进行代码组件化后重构。关于应用架构以及组件化的方案 <a href="https://casatwy.com/iOS-Modulization.html" target="_blank" rel="external">casatwy</a> 已经说得很透彻了，在这里我就没有必要再班门弄斧了。这篇文章主要是记录自己项目组件化时如何拆分各个功能模块？抽离组件遇到了哪些问题？阶段性测试时遇到了哪些棘手的问题？因此，这篇文章的实践性较强，希望可以解决各位在组件化过程中遇到大部分问题。</p>
<h2 id="更新说明"><a href="#更新说明" class="headerlink" title="更新说明"></a>更新说明</h2><p>更新记录:</p>
<ul>
<li>2018 年 07 月，第一版。</li>
<li>2018 年 08 月，补充组件化架构图及一些说明。</li>
</ul>
<h2 id="现在项目中存在的问题"><a href="#现在项目中存在的问题" class="headerlink" title="现在项目中存在的问题"></a>现在项目中存在的问题</h2><p>代码不够整齐，目录结构混乱，分类不够明确，随着一次次的版本迭代，增加了不同的业务线，开发人员变动比较频繁，工程越来越臃肿。莫名其妙的继承关系，Base类，Expand类，Category混乱，三者之间存在重复的功能，这也为后面提到的在组件化过程中遇到一个棘手问题埋下了炸弹。</p>
<h2 id="期望达到的效果"><a href="#期望达到的效果" class="headerlink" title="期望达到的效果"></a>期望达到的效果</h2><ol>
<li>解除各个功能模块间的依赖；</li>
<li>可以单独引入并测试某一个功能组件；</li>
<li>功能与功能之间不再相互引用重复的未使用到的类；</li>
<li>将一个单一的工程项目，分解成各个独立的组件，然后按照某种方式，任意组合成一个拥有完整业务逻辑的工程。</li>
</ol>
<h2 id="组件划分粒度及其相互间的依赖"><a href="#组件划分粒度及其相互间的依赖" class="headerlink" title="组件划分粒度及其相互间的依赖"></a>组件划分粒度及其相互间的依赖</h2><p>组件化是为了解决项目中遇到的问题，不是为了组件化而组件化。模块的划分，以及模块的扩展性，可以增加新的模块，为将来业务的拓展留有余地。基础模块的划分很重要，其他的模块都是建立在基础模块之上的。</p>
<blockquote>
<p>兵马未动，基础组件先行。</p>
</blockquote>
<ul>
<li>基础组件(<strong>LZBasisComponents</strong>)：基本配置(常量，宏)，分类(各类系统类的拓展)，网络(AFN的封装)，工具类(loading，字符串操作，日期格式处理，文件操作等)</li>
<li>数据库组件(<strong>LZDataBaseComponents</strong>)：封装了各个功能模块的数据库增，删，改，查的基本操作，基于 <strong>FMDB</strong> 封装了基本的 <strong>SQLite</strong> 数据库操作；</li>
<li>功能组件(<strong>LZFunctionComponents</strong>)：主要用来存放一些自定义控件，eg.自定义弹出窗，错误信息提示View，自定义<strong>KeyBoardView</strong>，一些按钮和label；</li>
<li>登录组件(<strong>LZLoginComponents</strong>)：项目中通过登录操作初始化一些基本配置，配置账号体系下用户所能使用的权限。基于登录功能业务上衍生了广告页，热门活动宣传页，某个版本需要强制升级的弹出窗，以及用户协议等功能。</li>
<li>工具箱组件(<strong>LZToolsComponents</strong>)：项目中处理不同设备间数据同步的功能，页面展示的权限控制功能。</li>
</ul>
<blockquote>
<p>自顶向下设计，自底向上实现，先测量，后优化。— casatwy</p>
</blockquote>
<p>以上所列的 <em>6</em> 个组件可以统称为项目基础组件，自基础向上延伸到其他功能模块，为其他模块提供底层支持，同时，在生成私有库时，其他功能模块也要与之建立起依赖关系。</p>
<p>这里数据的持久化基于数据库组件，其中公共类的维护 (以数据库组件为例，每个人维护自己模块下的数据库操作类。eg.LZDatabaseHelper+PatientModel 即为，患者组件下对应的所有患者的数据库操作，处理后的数据以 PatientModel 为存储形式。)</p>
<blockquote>
<p>找到所有需要的模块， 把模块放在该放的地方。 — casatwy</p>
</blockquote>
<p>一个公共模块，如果多个模块都会用到，那么最好是将它抽成一个组件。eg. <strong>LZToolsComponents</strong> 组件中，就存放了一些工具类，这些工具类无法下沉到基础组件中。但其它模块却会用到。</p>
<blockquote>
<p>高内聚，低耦合。</p>
</blockquote>
<p>接下来按功能模块划分组件就比较直观了，比较典型的就是根据 <strong>TableBar</strong> 来划分，这里适用于大部分 App 的功能模块。以下这些功能组件的划分才是组件化划分的核心所在，也只有将功能组件独立出来，才能达到高内聚，低耦合的目的。</p>
<ul>
<li>工作台组件(<strong>LZWorkTableComponents</strong>)：主要处理项目中核心功能 — 开方，该模块下由三个小模块组成；</li>
<li>药房管理组件(<strong>LZPharmacyComponents</strong>)：涉及到药品库存管理的模块；</li>
<li>患者管理组件(<strong>LZPatientManageComponent</strong>)：管理患者个人就诊信息；</li>
<li>个人中心组件(<strong>LZMineComponents</strong>)：配置用户的个人信息，设置处方模板，管理诊所子账号，增值服务，账号设置，配置外接硬件(蓝牙打印机，激光打印机，扫码枪)等</li>
<li>所有H5功能组件(<strong>LZWebViewComponents</strong>)：该组件统一管理统计报表，专家咨询，知识课堂，活动商城等功能模块的 <strong>web</strong> 页面。</li>
</ul>
<p>以上各功能组件都分别对应各自的中间件，用来同其他功能组件进行通讯。如下，</p>
<ul>
<li>登录中间件(<strong>LZLoginComponents_Category</strong>)：主要用来处理登录组件(<strong>LZLoginComponents</strong>)与主工程之间的数据通讯；</li>
<li>工作台中间件(<strong>LZWebViewComponents_category</strong>)</li>
<li>药房管理中间件(<strong>LZPharmacyComponents_Category</strong>)</li>
<li>患者管理中间件(<strong>LZPatientManageComponent_Category</strong>)</li>
<li>个人中心中间件(<strong>LZMineComponents_Category</strong>)</li>
<li>H5交互中间件(<strong>LZWebViewComponents_category</strong>)</li>
</ul>
<p>项目最终的架构图如下，</p>
<p><img src="https://xibhe.oss-cn-beijing.aliyuncs.com/moduleArchitecture.png" alt=""></p>
<p>其中，webView组件处理了三个H5功能模块的页面展示及数据交互，这里把它归为业务组件的范畴。</p>
<p>以上是基础组件和功能组件的划分，正是有了这些泾渭分明的区分，才能为组件化之间解耦提供基础的支持。</p>
<h2 id="MVC-VS-MVVM"><a href="#MVC-VS-MVVM" class="headerlink" title="MVC VS MVVM"></a>MVC VS MVVM</h2><p>对于组件化后继续使用 <strong>MVC</strong> 架构还是替换为 <strong>MVVM</strong>架构。这二者只是代码层次划分，主要是针对数据流动的方向而言。这里以解决问题为主，而不是生搬硬套架构。本片文章主要用来介绍组件化的实现流程，这里就不对架构做详细叙述了。但随着组件化的深入，这二者间终会有一个抉择，后续计划单独整理出二者之间关系的文章。</p>
<h2 id="CoCoaPods-私有库"><a href="#CoCoaPods-私有库" class="headerlink" title="CoCoaPods 私有库"></a>CoCoaPods 私有库</h2><p>通过 <strong>cocopods</strong> 把组件打包成单独的 <strong>私有pod</strong> 库来进行管理，这样就可以通过 <strong>podfile</strong> 文件，进行动态的增删和版本管理了。</p>
<h3 id="1-使用模板快速创建测试工程（组件所在的工程）"><a href="#1-使用模板快速创建测试工程（组件所在的工程）" class="headerlink" title="1.使用模板快速创建测试工程（组件所在的工程）"></a>1.使用模板快速创建测试工程（组件所在的工程）</h3><blockquote>
<p>$ pod lib create LZBasisComponents</p>
</blockquote>
<p><img src="https://xibhe.oss-cn-beijing.aliyuncs.com/ModuleFirstExplore_cocoaPods01.jpeg" alt="创建模板工程"></p>
<p>按照提示，填写完以上信息后， Xcode 会自动打开创建的测试工程，在测试工程的文件夹下，可以看到的路径如下，</p>
<p><img src="https://xibhe.oss-cn-beijing.aliyuncs.com/ModuleFirstExplore_cocoaPods02.png.jpeg" alt="模板工程文件路径"></p>
<p>其中，将抽离出的基础组件 <strong>LZBasisComponents</strong> 托至 <strong>Classes</strong> 文件夹下，此时，<strong>cd</strong> 到模板工程 <strong>Example</strong> 所在目录，执行</p>
<blockquote>
<p>$ pod install</p>
</blockquote>
<p>我们就可以在测试组件的模板工程中修改文件了。</p>
<h3 id="2-在-GitLab-上创建一个用来存放基础组件的仓库LZBasisComponents"><a href="#2-在-GitLab-上创建一个用来存放基础组件的仓库LZBasisComponents" class="headerlink" title="2.在 GitLab 上创建一个用来存放基础组件的仓库LZBasisComponents"></a>2.在 GitLab 上创建一个用来存放基础组件的仓库LZBasisComponents</h3><p>这里使用开源的 <strong>GitLab</strong> 作为代码托管的 <strong>git</strong> 服务器，安装完成后可以在上面新建组件。当然也可以付费使用基于 <strong>GitHub</strong> 托管，免费的有 <em><a href="https://gitee.com" target="_blank" rel="external">码云</a></em> 和 <em><a href="https://coding.net" target="_blank" rel="external">码市</a></em>。</p>
<h3 id="3-配置私有库的-podspec-文件"><a href="#3-配置私有库的-podspec-文件" class="headerlink" title="3.配置私有库的 .podspec 文件"></a>3.配置私有库的 .podspec 文件</h3><p>在上文中生成模板工程的同时，也会生成一个 <strong>. podspec</strong> 的文件。我们需要单独设置该文件，之所以配置 <strong>.podspec</strong> 文件，是为了将本地私有库与 <strong>GitLab</strong> 上远程私有库进行关联，多人开发时通过远程私有组件库进行代码的同步。远程索引库 <strong>. podspec</strong> 即，组件描述文件，里面描述了组件文件的源码地址，框架简介，私有库作者，版本号，资源文件路径等信息。我们使用 <strong>$ pod search</strong> 检索索引文件，找到 <strong>. podspec</strong> 中的源码地址，然后将项目down到本地。其主要配置如下，</p>
<pre><code class="js">s.name         = &quot;LZBasisComponents&quot;
s.version      = &quot;1.2.2.1&quot;
s.summary      = &quot;LZBasisComponents.&quot;

s.homepage     = &quot;http://192.168.11.11/CloudOfficeModulization/LZBasisComponents&quot;
s.license      = { :type =&gt; &quot;MIT&quot;, :file =&gt; &quot;FILE_LICENSE&quot; }
s.author       = &quot;xibHe&quot;
s.platform     = :ios, &quot;8.4&quot;

s.source       = { :git =&gt; &quot;http://192.168.11.11/CloudOfficeModulization/LZBasisComponents.git&quot;, :tag =&gt; s.version.to_s }
s.source_files  = &quot;LZBasisComponents/LZBasisComponents/Classes/**/*.{h,m}&quot;

s.resource_bundles = {
&#39;LZBasisComponents&#39; =&gt; [&#39;LZBasisComponents/LZBasisComponents/Assets/*.{png,plist}&#39;]
}

s.requires_arc = true

s.dependency &quot;Masonry&quot;, &#39;~&gt; 1.1.0&#39;
s.dependency &quot;YYKit&quot;, &#39;~&gt; 1.0.9&#39;
s.dependency &quot;ReactiveObjC&quot;
</code></pre>
<p>具体的配置如下：</p>
<ul>
<li><strong>s.homepage</strong> 组件在 <strong>GitLab</strong> 的主页面</li>
<li><strong>s.source</strong> 真实组件的地址，在 <strong>GitLab</strong> 中新建库时会生成该地址</li>
<li><strong>s.source_files</strong> 组件中对应目录下的文件夹</li>
<li><strong>s.resource_bundles</strong> 存放资源文件的类型</li>
<li><strong>s.dependency</strong> 依赖其他的框架或组件</li>
</ul>
<p>这里是组件中用到的主要的配置，还有其它的与私有 <strong>pod</strong> 相关的配置。</p>
<p>注意: 组件的依赖关系，各个组件中的 <strong>.podspec</strong> 文件中通过 <strong>s.dependency</strong> 设置了该组件与其他三方框架或者其他业务组件的依赖关系，这里各个组件前期可以暂时依赖其他业务组件，但后期当所有组件抽出后，需要解除与其他业务组件的依赖关系。即，将 <strong>s.dependency</strong> 下的依赖注释掉。</p>
<h3 id="4-将上面创建的模板工程，提交到-GitLab-上创建的远程代码仓库中"><a href="#4-将上面创建的模板工程，提交到-GitLab-上创建的远程代码仓库中" class="headerlink" title="4.将上面创建的模板工程，提交到 GitLab 上创建的远程代码仓库中"></a>4.将上面创建的模板工程，提交到 GitLab 上创建的远程代码仓库中</h3><p>主要是通过 <strong>git</strong> 命令上传，如下</p>
<h4 id="1-cd-到-模板工程所在的-Example-对应的私有库目录"><a href="#1-cd-到-模板工程所在的-Example-对应的私有库目录" class="headerlink" title="1. cd 到 模板工程所在的 Example 对应的私有库目录"></a>1. cd 到 模板工程所在的 <strong>Example</strong> 对应的私有库目录</h4><h4 id="2-可以先查看当前工程文件的状态，红色为未提交"><a href="#2-可以先查看当前工程文件的状态，红色为未提交" class="headerlink" title="2. 可以先查看当前工程文件的状态，红色为未提交"></a>2. 可以先查看当前工程文件的状态，红色为未提交</h4><blockquote>
<p>git status </p>
</blockquote>
<h4 id="3-提交到暂缓区"><a href="#3-提交到暂缓区" class="headerlink" title="3. 提交到暂缓区"></a>3. 提交到暂缓区</h4><blockquote>
<p>git add .</p>
</blockquote>
<h4 id="4-将本地库与远程代码仓库进行关联"><a href="#4-将本地库与远程代码仓库进行关联" class="headerlink" title="4. 将本地库与远程代码仓库进行关联"></a>4. 将本地库与远程代码仓库进行关联</h4><blockquote>
<p>git remote add origin <a href="http://192.168.11.11/CloudOfficeModulization/LZBasisComponents.git" target="_blank" rel="external">http://192.168.11.11/CloudOfficeModulization/LZBasisComponents.git</a></p>
</blockquote>
<h4 id="5-初始化提交"><a href="#5-初始化提交" class="headerlink" title="5. 初始化提交"></a>5. 初始化提交</h4><blockquote>
<p>git commit -m “Initial commit”</p>
</blockquote>
<h4 id="6-将本地分支的更新，推送到远程主机"><a href="#6-将本地分支的更新，推送到远程主机" class="headerlink" title="6. 将本地分支的更新，推送到远程主机"></a>6. 将本地分支的更新，推送到远程主机</h4><blockquote>
<p>git push -u origin master</p>
</blockquote>
<h4 id="7-给远程组件库打-tag"><a href="#7-给远程组件库打-tag" class="headerlink" title="7. 给远程组件库打 tag"></a>7. 给远程组件库打 tag</h4><blockquote>
<p>git tag -a 1.2.2.1 -m ‘v1.2.2.1’</p>
<p>git push origin master</p>
</blockquote>
<p>保持 <strong>s.version</strong> = “1.2.2.1” 的版本与远程私有库的 <strong>tag</strong> 一致。</p>
<h3 id="5-主工程中使用-CoCoaPods-导入私有组件库"><a href="#5-主工程中使用-CoCoaPods-导入私有组件库" class="headerlink" title="5.主工程中使用 CoCoaPods 导入私有组件库"></a>5.主工程中使用 CoCoaPods 导入私有组件库</h3><p>打开并编辑主工程中的 <strong>Podfile</strong> 文件，如下，</p>
<pre><code class="js">platform :ios, &#39;8.4&#39;

source &#39;http://192.168.11.11/CloudOfficeModulization/CloudOfficeSpec.git&#39;
source &#39;https://github.com/CocoaPods/Specs.git&#39;

workspace &#39;CloudOffice.xcworkspace&#39;
#use_frameworks!
inhibit_all_warnings!

def common_pods
    pod &#39;LZBasisComponents&#39;, :path =&gt; &#39;/Users/huahua/Documents/Module/LZBasisComponents&#39;

end

target  ‘CloudOffice’ do

    common_pods

end

target  ‘CloudOfficeTest’ do

    common_pods

end

target  ‘CloudOfficeTrial’ do

    common_pods

end
</code></pre>
<p>通过命令 <strong>pod repo</strong> 查看本地已存在的索引库，</p>
<pre><code class="js">14-cloudofficemodulization-cloudofficespec
- Type: git (master)
- URL:  http://192.168.11.11/CloudOfficeModulization/CloudOfficeSpec.git
- Path: /Users/huahua/.cocoapods/repos/14-cloudofficemodulization-cloudofficespec

master
- Type: git (master)
- URL:  https://github.com/CocoaPods/Specs.git
- Path: /Users/huahua/.cocoapods/repos/master
</code></pre>
<p><strong>GitLab</strong> 中远程私有库的地址：</p>
<pre><code class="js">source &#39;http://192.168.11.11/CloudOfficeModulization/CloudOfficeSpec.git&#39;
</code></pre>
<p>公有库的地址：</p>
<pre><code class="js">source &#39;https://github.com/CocoaPods/Specs.git&#39;
</code></pre>
<p>cd 到主工程 <strong>Podfile</strong> 文件所在目录，执行 <strong>pod install</strong> 命令，再次打开项目就可以在 <strong>Pods</strong> 文件夹下的 <strong>Development Pods</strong> 文件夹中找到 <strong>LZBasisComponents</strong> 组件。</p>
<p>注意：pod ‘LZBasisComponents’, :path =&gt;’/Users/huahua/Documents/Module/LZBasisComponents’ 对应的路径可以是存放本地私有库(已update远程私有库)的路径，也可以是 <strong>步骤4</strong> 中对应的远程私有库，可以通过通过 tag 来导入不同的私有组件库的版本，如下：</p>
<pre><code class="js">pod &#39;LZBasisComponents&#39;, &#39;~&gt; 1.2.2.1&#39;
</code></pre>
<p>也可以通过 <strong>SourceTree</strong> 或者 <strong>GitHub Desktop</strong> 等拥有可视化界面的项目版本控制软件，进行 <strong>git</strong> 项目私有库的管理。</p>
<h2 id="组件之间及各组件与主工程间通讯-中间件"><a href="#组件之间及各组件与主工程间通讯-中间件" class="headerlink" title="组件之间及各组件与主工程间通讯(中间件)"></a>组件之间及各组件与主工程间通讯(中间件)</h2><p>目前市面上有两种组件间的通讯方式：</p>
<ol>
<li>利用 <strong>url-scheme</strong> 方案</li>
<li>利用 <strong>runtime</strong> 实现的 <strong>target-action</strong> 方法</li>
</ol>
<p>两种方式都对应一些开源库，如下</p>
<p><strong>URL-Scheme库：</strong></p>
<ol>
<li><a href="https://github.com/joeldev/JLRoutes" target="_blank" rel="external">JLRoutes</a></li>
<li><a href="https://github.com/clayallsopp/routable-ios" target="_blank" rel="external">routable-ios</a></li>
<li><a href="https://github.com/lightory/HHRouter" target="_blank" rel="external">HHRouter</a></li>
<li><a href="https://github.com/mogujie/MGJRouter" target="_blank" rel="external">MGJRouter</a></li>
</ol>
<p><strong>Target-Action库：</strong></p>
<ol>
<li><a href="https://github.com/casatwy/CTMediator" target="_blank" rel="external">CTMediator</a></li>
</ol>
<p>采用 <strong>url-scheme</strong> 方案，要本地调用和远程调用之间如何相互调用？提供给 <strong>url</strong> 什么样的参数？如何处理非常规对象与本地组件间的调度？</p>
<blockquote>
<p>在iOS领域里，一定是组件化的中间件为openUrl提供服务，而不是openUrl方式为组件化提供服务。 — casatwy</p>
<p>URL注册对于实施组件化方案是完全不必要的，且通过URL注册的方式形成的组件化方案，拓展性和可维护性都会被打折。 — casatwy</p>
</blockquote>
<p>采用 <strong>runtime</strong> 实现的 <strong>target-action</strong> 方法</p>
<blockquote>
<p>注册 <strong>URL</strong> 的目的其实是一个服务发现的过程，在iOS领域中，服务发现的方式是不需要通过主动注册的，使用 <strong>runtime</strong> 就可以了。另外，注册部分的代码的维护是一个相对麻烦的事情，每一次支持新调用时，都要去维护一次注册列表。如果有调用被弃用了，是经常会忘记删项目的。<strong>runtime</strong> 由于不存在注册过程，那就也不会产生维护的操作，维护成本就降低了。</p>
<p>由于通过 <strong>runtime</strong> 做到了服务的自动发现，拓展调用接口的任务就仅在于各自的模块，任何一次新接口添加，新业务添加，都不必去主工程做操作，十分透明。— casatwy</p>
</blockquote>
<p><img src="https://xibhe.oss-cn-beijing.aliyuncs.com/ModuleFirstExplore_target-action.png" alt="target-action"></p>
<p>如图，<strong>target-action</strong> 模式，即，目标-行为，行为即要调用的方法，目标即消息的接收对象（Objective-C 语言使用消息机制，类似但不同于方法调用）。整个过程为：用户点击按钮，触发某事件发生，该消息由按钮传到另外的接收对象，接收对象再做相应处理。接收对象可以为任何对象，但通常为控制器（<strong>Controller</strong>）。</p>
<p><strong>target-action</strong> 的代码实现逻辑：</p>
<blockquote>
<ol>
<li>运行时，runtime是一套底层的C语言api，可以通过runtime获取类的私有变量；动态增加类、成员变量和方法；动态修改类、成员变量和方法；对换两个方法的实现（<strong>Swizzle</strong>）</li>
<li>NSInvocation 和 performSelector：withObject：，直接调用某个对象的消息</li>
<li>调用methodSignatureForSelector：方法，尝试获得一个方法签名。如果获取不到，则直接调用doesNotRecognizeSelector抛出异常。如果能获取到，则返回非nil，创建一个NSInvocation并传给forwardInvocation:</li>
<li>调用编译器指令，返回一个给定类型编码为一种内部表示的字符串</li>
<li>提供外部模块调用的方法。</li>
</ol>
</blockquote>
<p>组件之间的交互，通过 <strong>Action</strong> 暴露可调用接口，所有组件都通过组件自带的<strong>Target-Action</strong> 来响应，也就是说，模块与模块之间的接口被固化在了 <strong>Target-Action</strong> 这一层，避免了实施组件化的改造过程中，对业务层的侵入，同时也提高了组件化接口的可维护性。 </p>
<p>基于以上原因，这里我推荐 <strong>Target-Action</strong> 方案。具体操作流程如下，</p>
<h3 id="新增基于-CTMediator-的组件-LZMediator"><a href="#新增基于-CTMediator-的组件-LZMediator" class="headerlink" title="新增基于 CTMediator 的组件 LZMediator"></a>新增基于 CTMediator 的组件 LZMediator</h3><p>基于 <a href="https://github.com/casatwy/CTMediator" target="_blank" rel="external">CTMediator</a> 新建用于传递组件讯息的组件 <strong>LZMediator</strong>，该组件参考 <a href="https://github.com/casatwy/CTMediator" target="_blank" rel="external">CTMediator</a> 中的 <strong>CTMediator</strong> 类，做了一些简化处理。具体创建操作参照上文中使用 <strong>CoCoaPods</strong> 建立私有库，这里就不再赘述了。</p>
<h3 id="新建与其它组件通讯的中间件"><a href="#新建与其它组件通讯的中间件" class="headerlink" title="新建与其它组件通讯的中间件"></a>新建与其它组件通讯的中间件</h3><p>这里的所说的中间件也是以 <strong>pod</strong> 私有库的形式存在于项目中，其仍是代表不同功能模块的组件。以工作台组件（<strong>LZWorkTableComponents</strong>）为例，其它组件若想调用工作台组件中的某个控制器时，不能直接调用，而是需要通过工作台中间件（<strong>LZWorkTableComponents_Category</strong>）暴露的接口调用。同上文中使用<strong>CoCoaPods</strong> 建立私有库一样，先生成模板工程，然后上传到 <strong>GitLab</strong> 远程代码厂库中。唯一需要注意的是：需要在工作台中间件的 <strong>.podspec</strong> 文件中，增加对 <strong>LZMediator</strong> 组件的依赖，如下：</p>
<pre><code class="js">s.dependency &quot;LZMediator&quot;
</code></pre>
<p>通过这种依赖关系，将 <strong>LZMediator</strong> 引入到工程中。</p>
<h3 id="在中间件中新增用于通讯的-LZMediator-类别"><a href="#在中间件中新增用于通讯的-LZMediator-类别" class="headerlink" title="在中间件中新增用于通讯的 LZMediator 类别"></a>在中间件中新增用于通讯的 LZMediator 类别</h3><p>在上面新建的工作台中间件（<strong>LZWorkTableComponents_Category</strong>）中新建基于 <strong>LZMediator</strong> 的类别，注意统一类别的名称，以工作台中间件为例，最终生成的类名为：<strong>LZMediator+LZWorkTableComponents.h</strong> 和 <strong>LZMediator+LZWorkTableComponents.m</strong> 接下来就是按照基于 <strong>Mediator</strong> 的一套逻辑，通过实现 <strong>target-action</strong> 的方法来进行不同组件间的通讯。例如，某个组件需要调用工作台组件中的某个控制器时，</p>
<p><strong>LZMediator+LZWorkTableComponents.h</strong> 中声明中间件调用的返回工作台组件中某个控制器的实例方法：</p>
<pre><code class="objectivec">#pragma mark - 患者管理组件调用
/**
 看病开方详情页面
 @return 返回实例
 */
- (UIViewController *)LZWorkTableComponents_newDoctorPrescribingViewControllerWithDic:(NSDictionary *)params;
</code></pre>
<p><strong>LZMediator+LZWorkTableComponents.m</strong> 中实现该方法：</p>
<pre><code class="objectivec">#pragma mark - 统一前缀
NSString *const kLZMediatorTarget_LZWorkTableComponents = @&quot;LZWorkTableComponents&quot;;

#pragma mark - 方法名称
NSString *const kLZMediatorAction_newDoctorPrescribingViewController = @&quot;newDoctorPrescribingViewController&quot;;  // 看病开方详情页面

- (UIViewController *)LZWorkTableComponents_newDoctorPrescribingViewControllerWithDic:(NSDictionary *)params
{
    UIViewController *viewController = [self performTarget:kLZMediatorTarget_LZWorkTableComponents action:kLZMediatorAction_newDoctorPrescribingViewController params:params shouldCacheTarget:NO];
    if ([viewController isKindOfClass:[UIViewController class]]) {
        return viewController;
    }
    return [UIViewController new];
}
</code></pre>
<p>这里需要注意方法中传递的参数 <strong>kLZMediatorTarget_LZWorkTableComponents</strong> 和 <strong>kLZMediatorAction_newDoctorPrescribingViewController</strong> 分别对应工作台组件中 <strong>target-action</strong> 所在的模块 (也就是提供服务的模块，这也是单独的repo，但无需被其他人依赖，其他人通过category调用这里的功能），这两个参数，前者对应的是 <strong>target-action</strong> 所在组件中的以 <strong>Target_</strong> 为前缀的类，后者对应该类里的具体的以 <strong>Action_</strong> 为前缀声明的某个方法。前面所说的利用 <strong>runtime</strong> 实现的 <strong>target-action</strong> 方法，指的正是这个地方。</p>
<p>注意: 这两个参数值，一定要与工作台组件中 <strong>Target</strong> 目录下的类名相一致!!! 切记！ 切记！ 切记！ </p>
<h3 id="在-target-action-所在的组件中增加提供服务的类"><a href="#在-target-action-所在的组件中增加提供服务的类" class="headerlink" title="在 target-action 所在的组件中增加提供服务的类"></a>在 target-action 所在的组件中增加提供服务的类</h3><p>在工作台组件（<strong>LZWorkTableComponents</strong>）中 <strong>Target</strong> 目录下新建名称为： <strong>Target_LZWorkTableComponents</strong> 继承于 <strong>NSObject</strong> 的类，这个类的命名规则与上面说的 <strong>kLZMediatorTarget_LZWorkTableComponents</strong> 参数相一致，然后新增方法，方法名以前缀 <strong>Action_</strong> 开头，同样需要与上面说的<strong>kLZMediatorAction_newDoctorPrescribingViewController</strong> 参数相一致。如下：</p>
<p><strong>Target_LZWorkTableComponents.h</strong> 中声明中间件调用的返回工作台组件中某个控制器的实例方法：</p>
<pre><code class="objectivec">#pragma mark - 患者管理组件调用
/**
 返回LZNewDoctorPrescribingViewController实例
 */
- (UIViewController *)Action_newDoctorPrescribingViewController:(NSDictionary *)param;
</code></pre>
<p><strong>Target_LZWorkTableComponents.m</strong> 中实现该方法：</p>
<pre><code class="objectivec">#import &lt;LZDataBaseComponents/PationModel.h&gt;
#import &quot;LZNewDoctorPrescribingViewController.h&quot;

/**
 返回LZNewDoctorPrescribingViewController实例

 @param param 患者dictionary
 @return LZNewDoctorPrescribingViewController实例
 */
- (UIViewController *)Action_newDoctorPrescribingViewController:(NSDictionary *)param
{
    PationModel *pationModel = [[PationModel alloc] init];
    [pationModel setValuesForKeysWithDictionary:param];

    LZNewDoctorPrescribingViewController *newDoctorPrescribinVC = [[LZNewDoctorPrescribingViewController alloc] init];
    newDoctorPrescribinVC.model = pationModel;

    return newDoctorPrescribinVC;
}
</code></pre>
<p>这里 <strong>PationModel</strong> 为数据库组件中的类，需要注意一下这里使用尖括号引入的头文件，<strong>LZNewDoctorPrescribingViewController</strong> 控制器为工作台组件中的类。</p>
<h3 id="在其它组件中调用中间件的方法进行通讯"><a href="#在其它组件中调用中间件的方法进行通讯" class="headerlink" title="在其它组件中调用中间件的方法进行通讯"></a>在其它组件中调用中间件的方法进行通讯</h3><p>这里仍以工作台组件（<strong>LZWorkTableComponents</strong>）为例，比如，在患者组件中想跳转至工作台组件中的看病开方详情页（<strong>LZNewDoctorPrescribingViewController</strong>），需要通过上面的工作台中间件（<strong>LZWorkTableComponents_Category</strong>）进行通讯，而不是直接导入 <strong>#import “LZNewDoctorPrescribingViewController.h”</strong> 头文件调用。具体事例，如下：</p>
<p>在患者管理组件中，</p>
<pre><code class="objectivec">#import &lt;LZWorkTableComponents_Category/LZMediator+LZWorkTableComponents.h&gt;

NSDictionary *pationModelDic = model.mj_keyValues;
UIViewController *newDoctorVC = [[LZMediator sharedInstance]  LZWorkTableComponents_newDoctorPrescribingViewControllerWithDic :pationModelDic];
[weakSelf presentViewController: newDoctorVC animated:YES completion:nil];
</code></pre>
<p>这里通过一个 <strong>LZMediator</strong> 的单例来调用工作台中间件（<strong>LZWorkTableComponents_Category</strong>）中 <strong>LZMediator</strong> 的类别(<strong>LZMediator+LZWorkTableComponents</strong>) 中的方法，获得 <strong>view controller</strong> 之后，在这种场景下，到底 <strong>push</strong> 还是 <strong>present</strong> ，其实是要由使用者决定的，<strong>mediator</strong> 只要给出 <strong>view controller</strong> 的实例就好了。</p>
<h2 id="原工程中资源文件的处理"><a href="#原工程中资源文件的处理" class="headerlink" title="原工程中资源文件的处理"></a>原工程中资源文件的处理</h2><p>这里所说的资源文件指的是项目中的图片，现在主工程中的 <strong>Assets</strong> 存放全部的资源文件，需要将其移动到各个组件中去。在上文新建模板工程时，对应文件夹下也会生成一个 <strong>Assets</strong> 文件夹，这个文件夹就是用来存放组件中使用到的图片文件的。 针对这个文件夹中图片资源的存放和使用，有两种方式：</p>
<ol>
<li>直接将图片 <strong>copy</strong> 到模板工程中 <strong>Assets</strong> 文件夹下，包括 <strong>@2x</strong>, <strong>@3x</strong> 图片；</li>
<li>在工程中组件下 <strong>Resources</strong> 目录下，新建 <strong>Assets.xcassets</strong> 文件，直接将图片拖放到 <strong>Assets</strong> 文件中，与主工程中 <strong>Assets</strong> 文件的用法一致。</li>
</ol>
<p>针对以上两种存放图片的方式，在文件中读取图片的方式也完全不同。方式一：</p>
<pre><code class="js">s.resource_bundles = {
&#39;LZBasisComponents&#39; =&gt; [&#39;LZBasisComponents/LZBasisComponents/Assets/*.{png,plist}&#39;]
}
</code></pre>
<p>需要在对应组件的 <strong>.podspec</strong> 文件中设置访问图片资源的路径及资源文件类型，然后在项目中导入所要访问的图片，最后访问图片，如下：</p>
<pre><code class="objectivec">[UIImage imageWithName:@&quot;xtsz_N&quot; bundleName:@&quot;LZBasisComponents&quot;];
</code></pre>
<p>访问图片时需要在方法 <strong>bundleName:</strong> 后面加上图片所在的组件名称。可以写一个 <strong>UIImage</strong> 的类别统一加载组件图片资源，</p>
<pre><code class="objectivec">@interface UIImage (Image)

//组件之间加载图片资源
+ (UIImage *)imageWithName:(NSString *)imageName forClass:(Class)sourceClass;
+ (UIImage *)imageWithName:(NSString *)imageName bundleName:(NSString *)bundleName;
+ (UIImage *)imageWithName:(NSString *)imageName bundleName:(NSString *)bundleName forClass:(Class)sourceClass;
</code></pre>
<p>方式二：相比方式一，更加简单，管理图片也更加直观。可以直接使用原来的方法<strong>imageWithName</strong> 来加载图片。但这里需要注意这个存放资源图片文件在组件中对应的路径并不在模板工程 <strong>Assets</strong> 路径下。</p>
<h2 id="受工期影响"><a href="#受工期影响" class="headerlink" title="受工期影响"></a>受工期影响</h2><ol>
<li>抽取组件前未将项目中冗余的类删除，导致这些类最后被抽到组件中；</li>
<li>在抽取组件时，版本仍在继续迭代，这就造成组件抽取完成后，需要再花时间合并新代码到组件中；</li>
<li>前期为了快速分离功能组件，往往将与该组件关联的其它功能模块的代码也抽到组件中；</li>
</ol>
<p>出现 <strong>2</strong> 中的情况，就需要记录一下新版本迭代修改了组件中的哪些类，还要记录提测后修改 <strong>QA</strong> 提出的 bug 时修改了哪些类，最后，再对比 <strong>Git</strong> 和 <strong>svn</strong> 的提交日志，查看修改了哪些类。</p>
<h2 id="组件化过程中遇到的问题及解决方式"><a href="#组件化过程中遇到的问题及解决方式" class="headerlink" title="组件化过程中遇到的问题及解决方式"></a>组件化过程中遇到的问题及解决方式</h2><p>抽离业务组件，一般分为四步，这里以抽离患者管理组件为例：</p>
<ol>
<li>将患者管理模块所有代码 <strong>copy</strong> 到新建的患者管理模板工程中（注意要将复制的代码放到 <strong>ReplaceMe.m</strong> 所在目录下）；</li>
<li>梳理患者管理中与主工程有交互的功能类，明确使用了哪些三方库和自定义控件，剔除未使用到的类，整理工程目录结构（这一步主要是整理现有的代码逻辑，结构，去除冗余的类）；</li>
<li>将模板工程中患者管理代码中涉及数据库操作，公用模块，全局自定义控件等其它组件的功能抽出来。那些暂时无法划分到其它组件中的类，暂时 <strong>copy</strong> 一份放到 <strong>Redundancy</strong> 文件夹下。患者管理组件只能导入其它组件并引用后，才能使用。不能再以直接引入主工程的头文件的方式调用类了（这一步主要是从组件角度斩断组件与主工程单方面的关联）；</li>
<li>将患者管理模块所在的模板工程上传至 <strong>GitLab</strong>，然后在已集成了基础组件的壳工程中引入该组件并调试。</li>
</ol>
<p>第 <strong>4</strong> 步建立在壳工程之上，这里所谓的壳工程是指集成了主工程 <strong>AppDelegate</strong> 中初始化功能和基础组件，可以进行登录操作，同步用户的数据。有了数据就可以进行页面展示，就能进一步测试组件功能是否完整。</p>
<h3 id="1-duplicate-symbols-for-architecture-arm64"><a href="#1-duplicate-symbols-for-architecture-arm64" class="headerlink" title="1. duplicate symbols for architecture arm64"></a>1. duplicate symbols for architecture arm64</h3><pre><code class="objectivec">duplicate symbol_LZKanBingHomeViewController._closeImageV in:
    /Users/huahua/Library/Developer/Xcode/DerivedData/CloudOffice-enrpnhjeeqovpuffsdjmigxqovpi/Build/Intermediates.noindex/CloudOffice.build/Debug-iphoneos/CloudOfficeTest.build/Objects-normal/arm64/LZKanBingHomeViewController.o
    /Users/huahua/Library/Developer/Xcode/DerivedData/CloudOffice-enrpnhjeeqovpuffsdjmigxqovpi/Build/Products/Debug-iphoneos/LZWorkTableComponents/libLZWorkTableComponents.a(LZKanBingHomeViewController.o)
ld: 31 duplicate symbols for architecture arm64
clang: error: linker command failed with exit code 1 (use -v to see invocation)
</code></pre>
<p>根据错误提示，删除主工程中的重复类文件，因为这些类已经抽离到组件中了。这也是集成组件后联调出现最对，最常见的一种错误。</p>
<h3 id="2-OBJC-CLASS-LZKanBingHomeViewController-referenced-from-objc-class-ref-in-libLZWorkTableComponents-a-LZWorkTableMangerController-o-ld-symbol-s-not-found-for-architecture-arm64-clang-error-linker-command-failed-with-exit-code-1-use-v-to-see-invocation"><a href="#2-OBJC-CLASS-LZKanBingHomeViewController-referenced-from-objc-class-ref-in-libLZWorkTableComponents-a-LZWorkTableMangerController-o-ld-symbol-s-not-found-for-architecture-arm64-clang-error-linker-command-failed-with-exit-code-1-use-v-to-see-invocation" class="headerlink" title="2. _OBJC_CLASS_LZKanBingHomeViewController, referenced from: objc-class-ref in libLZWorkTableComponents.a(LZWorkTableMangerController.o) ld: symbol(s) not found for architecture arm64 clang: error: linker command failed with exit code 1 (use -v to see invocation)"></a>2. _OBJC_CLASS_LZKanBingHomeViewController, referenced from: objc-class-ref in libLZWorkTableComponents.a(LZWorkTableMangerController.o) ld: symbol(s) not found for architecture arm64 clang: error: linker command failed with exit code 1 (use -v to see invocation)</h3><pre><code class="objectivec">objc-class-ref in libLZWorkTableComponents.a(LZWorkTableMangerController.o)

ld: symbol(s) not found for architecture arm64
</code></pre>
<p>这个错误是由于向工程中某个组件下导入类时，未将导入类与与组件进行关联导致。根据错误提示 <strong>OBJC_CLASS_LZKanBingHomeViewController, referenced from: objc-class-ref in libLZWorkTableComponents.a</strong> 可以知道是工作台组件（<strong>LZWorkTableComponents</strong>）中的类（<strong>LZKanBingHomeViewController</strong>）未与组件建立关联。解决方式：在工程组件中选中 <strong>LZKanBingHomeViewController.m</strong> 切换到该类的 <strong>“Show the File inspector”</strong> 设置项中，检查文件的设置项。如图，</p>
<p> <img src="https://xibhe.oss-cn-beijing.aliyuncs.com/ModuleFirstExplore_inspector.png" alt="inspector"></p>
<p>设置 <strong>“Target Membership”</strong> 下 <strong>“LZWorkTableComponents”</strong> 为选中状态，重新编译，即可。 </p>
<h3 id="3-Property-‘text’-cannot-be-found-in-forward-class-object-‘PlaceholderTextView’Property-‘text’-cannot-be-found-in-forward-class-object-‘PlaceholderTextView’"><a href="#3-Property-‘text’-cannot-be-found-in-forward-class-object-‘PlaceholderTextView’Property-‘text’-cannot-be-found-in-forward-class-object-‘PlaceholderTextView’" class="headerlink" title="3. Property ‘text’ cannot be found in forward class object ‘PlaceholderTextView’Property ‘text’ cannot be found in forward class object ‘PlaceholderTextView’"></a>3. Property ‘text’ cannot be found in forward class object ‘PlaceholderTextView’Property ‘text’ cannot be found in forward class object ‘PlaceholderTextView’</h3><p>头文件重复引用的问题，可以在各个基础组件中新建 <strong>.h</strong> 头文件，用于存放其他类会用到类的头文件，使用时直接导入。例如：</p>
<pre><code class="objectivec">#import &lt;LZBasisComponents/LZBasisComponents.h&gt;
#import &lt;LZDataBaseComponents/LZDataBaseComponents.h&gt;
</code></pre>
<h3 id="4-GlobalMethod-showName-”请输入正确手机号码”-inView-self-headView-dianhuaView-不执行"><a href="#4-GlobalMethod-showName-”请输入正确手机号码”-inView-self-headView-dianhuaView-不执行" class="headerlink" title="4. [GlobalMethod showName:@”请输入正确手机号码” inView:self.headView.dianhuaView] 不执行"></a>4. [GlobalMethod showName:@”请输入正确手机号码” inView:self.headView.dianhuaView] 不执行</h3><p>这里 <strong>LZBasisComponents</strong> 中已经通过 <strong>GlobalMethod</strong> 类引入了<strong>MBProgressHUD</strong>，若在组件外重复引入新的 <strong>MBProgressHUD</strong> 会导致该代码不执行。</p>
<h3 id="5-暂时注释掉组件中跳转至其它组件控制器的方法"><a href="#5-暂时注释掉组件中跳转至其它组件控制器的方法" class="headerlink" title="5. 暂时注释掉组件中跳转至其它组件控制器的方法"></a>5. 暂时注释掉组件中跳转至其它组件控制器的方法</h3><p>由于组件间不能直接进行通讯，当用于处理组件间交互的中间件没有完成时，为了编译成功，可以先注释掉跳转到其它组件控制器的代码。</p>
<h3 id="6-Reference-to-‘LZHttpRequestPost’-is-ambiguous"><a href="#6-Reference-to-‘LZHttpRequestPost’-is-ambiguous" class="headerlink" title="6. Reference to ‘LZHttpRequestPost’ is ambiguous"></a>6. Reference to ‘LZHttpRequestPost’ is ambiguous</h3><pre><code class="objectivec">+ (void)hasNewRemoteConsulationWithParam:(NSDictionary *)param
  success:(void(^)(LZHttpResponseModel *responseModel))success
  failure:(void(^)(NSError *error))failure{

[self baseRequestWithParam:param path:[LZHttpDomainManage sharedInstance].YCHZ method:LZHttpRequestPost success:success failure:failure];
}
</code></pre>
<p>很奇怪的一个问题，项目中顶一个一个网络请求类型的枚举 — <strong>LZHttpRequestType</strong>，项目中很多用到 <strong>LZHttpRequestPost</strong> 这个枚举类型就会报这个错误，但只要将该参数换成枚举所对应的整数值就行。暂时先这样解决，后来再看这个错误，觉得是头文件重复引用造成的，之前的老项目中有有一个叫 <strong>Foundation.h</strong> 的头文件，里面引用的是一些基本的配置类，工具类，还有一个很奇怪的引用，每个项目开发者都会在这个头文件里引入自己所编写功能的头文件。例如，</p>
<pre><code class="objectivec">/*************此.h 文件是用来导入公用的头文件的***************/
#import &quot;GlobalMacro.h&quot;
#import &quot;URLMacro.h&quot;
#import &quot;GlobalMethod.h&quot;
#import &quot;PlaceholderTextView.h&quot;
#import &quot;UIImageView+WebCache.h&quot;

#import &quot;UIView+Frame.h&quot;
#import &quot;MJRefresh.h&quot;
#import &quot;HLNavigationController.h&quot;
#import &lt;AdSupport/ASIdentifierManager.h&gt;
#import &quot;NSString+MD5.h&quot;
#import &quot;Masonry.h&quot;
#import &quot;UILabel+LZLabel.h&quot;
#import &quot;NSArray+LZAddition.h&quot;

//多人开发，避免冲突
#import &quot;LWB.h&quot;
#import &quot;DLN.h&quot;
#import &quot;LYY.h&quot;
#import &quot;XXL.h&quot;
</code></pre>
<p>注释是为了避免多人开发的冲突，在这些每个人姓名首字母缩写的头文件中，引入的是这个人所开发功能类的头文件，就这样一层套一层。在组件中如果引用了这个<strong>Foundation.h</strong> 头文件，很大几率会造成重复重复引用。而且还有一点需要注意：组件中若要引入其它组件类的头文件，最好以尖括号引入。例如，引入基本组件中的某个类，</p>
<pre><code class="objectivec">#import &lt;LZBasisComponents/LZHttpDomainManage.h&gt;
</code></pre>
<p>一些基本的配置类的引入，工具类的引入，则可以用包含这些类的所有头文件的一个总的 <strong>.h</strong> 头文件的形式引入，</p>
<pre><code class="objectivec">#import &lt;LZBasisComponents/LZBasisComponents.h&gt;
</code></pre>
<p>就这样一步步的将那些多余的头文件和姓名首字母缩写的头文件从 <strong>Foundation.h</strong> 中移除，去除重复引入的头文件。</p>
<h3 id="7-iOS-9-3-5-系统下，页面布局错乱的问题"><a href="#7-iOS-9-3-5-系统下，页面布局错乱的问题" class="headerlink" title="7. iOS 9.3.5 系统下，页面布局错乱的问题"></a>7. iOS 9.3.5 系统下，页面布局错乱的问题</h3><p>组件拆分中遇到的一个很棘手的问题，在 <strong>iOS 9.3.5</strong> 的 <strong>ipad</strong> 上，左侧切换视图的选项显示不出来，同时，右侧页面布局错乱无法点击。运行项目， 点击<strong>Debug View Hierarchy</strong> 查看视图层级，发现左侧菜单所有切换按钮的布局都乱掉了，挤在一起了。主视图控制器中的 <strong>MainView</strong> 的 <strong>Frame</strong> 获取的一直都是错的，工程中 <strong>Frame</strong> 坐标的获取都是通过 <strong>UIView</strong> 的类别计算获取的，如果不通过类别获取是可以得到正确的值的。但即使将主视图和菜单中所有获取坐标的方式都通过系统方法获取，还是加载不出完整的视图。</p>
<p>最后搜索项目中所有与计算视图布局有关的类，发现了真相。主工程中有很多计算坐标的类别，这些类别重复定义了视图的坐标，需要移除未使用的类别。同时，将组件中计算坐标的 <strong>UIView+Frame</strong> 类移至主工程中，从 <strong>podFile</strong> 中移除 <strong>HandyFrame</strong>, 移除主工程中未使用到的 <strong>UIView+AutoLayout</strong>， <strong>UIView+TXFrame</strong> 等计算页面布局的类别。 </p>
<h3 id="8-Include-of-non-modular-header-inside-framework-module-‘LZBasisComponents-LZHttpClient’-‘-Users-zyjk-imac-penghe-Library-Developer-Xcode-DerivedData-CloudOffice-ffqipmpyrmrjqmevvpibbskoycre-Build-Products-Debug-iphoneos-AFNetworking-AFNetworking-framework-Headers-AFURLRequestSerialization-h’"><a href="#8-Include-of-non-modular-header-inside-framework-module-‘LZBasisComponents-LZHttpClient’-‘-Users-zyjk-imac-penghe-Library-Developer-Xcode-DerivedData-CloudOffice-ffqipmpyrmrjqmevvpibbskoycre-Build-Products-Debug-iphoneos-AFNetworking-AFNetworking-framework-Headers-AFURLRequestSerialization-h’" class="headerlink" title="8. Include of non-modular header inside framework module ‘LZBasisComponents.LZHttpClient’: ‘/Users/zyjk_imac-penghe/Library/Developer/Xcode/DerivedData/CloudOffice-ffqipmpyrmrjqmevvpibbskoycre/Build/Products/Debug-iphoneos/AFNetworking/AFNetworking.framework/Headers/AFURLRequestSerialization.h’"></a>8. Include of non-modular header inside framework module ‘LZBasisComponents.LZHttpClient’: ‘/Users/zyjk_imac-penghe/Library/Developer/Xcode/DerivedData/CloudOffice-ffqipmpyrmrjqmevvpibbskoycre/Build/Products/Debug-iphoneos/AFNetworking/AFNetworking.framework/Headers/AFURLRequestSerialization.h’</h3><pre><code class="objectivec">Include of non-modular header inside framework module &#39;LZBasisComponents.AFHTTPRequestOperationManager_Synchronous&#39;: &#39;/Users/zyjk_imac-penghe/Library/Developer/Xcode/DerivedData/CloudOffice-ffqipmpyrmrjqmevvpibbskoycre/Build/Products/Debug-iphoneos/AFNetworking/AFNetworking.framework/Headers/AFHTTPRequestOperationManager.h&#39;
</code></pre>
<p>AFN中头文件引用的包含了同一个头文件，删除报错类 <strong>.h</strong> 中一些重复的引用，改为 <strong>&lt; &gt;</strong> 引入。</p>
<pre><code class="objectivec">AFHTTPRequestOperationManager+Synchronous.h 中引入 #import &lt;AFNetworking/AFHTTPRequestOperationManager.h&gt;
AFHTTPRequestOperationManager+Synchronous.m 中引入 #import &lt;AFNetworking/AFNetworking.h&gt;
LZHttpClient.h 中引入 #import &lt;AFNetworking/AFURLRequestSerialization.h&gt;
LZHttpClient.m 中引入 #import &lt;AFNetworking/AFNetworking.h&gt;
</code></pre>
<h3 id="9-组件间的依赖关系"><a href="#9-组件间的依赖关系" class="headerlink" title="9. 组件间的依赖关系"></a>9. 组件间的依赖关系</h3><p>组件间的依赖关系，若两个组件间存在依赖，则依赖于某个组件的另一个组件可以直接引用所依赖组件中类的头文件，不需要加 <strong>&lt; &gt;</strong> 导入（但为了明确组件中引用类的来源，同时避免头文件的重复引用，建议以 <strong>&lt; &gt;</strong> 的方式引入头文件）。同理，若两个组件间不存在依赖关系，即使，使用了 <strong>&lt; &gt;</strong> 引用也无法引入该组件的任何文件。</p>
<p>这里需要明确项目中哪些功能模块为核心模块，哪些模块依存于核心模块。以我们项目为例，工作台组件（<strong>LZWorkTableComponents</strong>）为核心组件，在组件化初期可以以工作台组件为主，在其 <strong>.podspec</strong> 文件中依赖于其它功能组件，而不是中间件，</p>
<pre><code class="js"> s.dependency &quot;LZLoginComponents&quot;
 s.dependency &quot;LZPatientManageComponent&quot;
 s.dependency &quot;LZPharmacyComponents&quot;
 s.dependency &quot;LZMineComponents&quot;
</code></pre>
<p>此时需要注意：这种依赖关系是单向的。即，工作台组件依赖于其它功能组件，而其他功能组件不能依赖于工作台组件。这样也是为了避免组件间形成相互依赖的循环，为后面解除组件间依赖提供便利。</p>
<h3 id="10-如何将两个组件之间通过代理交互替换为通过中间件交互"><a href="#10-如何将两个组件之间通过代理交互替换为通过中间件交互" class="headerlink" title="10. 如何将两个组件之间通过代理交互替换为通过中间件交互"></a>10. 如何将两个组件之间通过代理交互替换为通过中间件交互</h3><p>项目中经常会用到代理处理两个不同功能间页面的跳转。在组件化过程中，也经常会遇到类似于 <strong>A组件</strong> 中的某个类需要调用 <strong>B组件</strong> 中的某个类，以完成从 <strong>A组件</strong> <strong>push 或者 present</strong> 或者 <strong>addSubview</strong> 到 <strong>B组件</strong> 控制器的逻辑。</p>
<p>这里普通的组件间通讯可以通过上文所说的 <strong>中间件</strong> ，复杂一些的，<strong>如将之前的代理替换为中间件</strong>需要做一些其他的处理，如下：</p>
<p>例如，工作台组件中 <strong>患者健康档案</strong>，需要调用患者管理组件中的 <strong>病例</strong> 模块，需要在患者管理中间件（<strong>LZPatientManageComponent_Category</strong>）中定义回调的方法，如下：</p>
<p>在类 <strong>LZMediator+LZPatientManageComponent</strong> 中，</p>
<pre><code class="objectivec">#pragma mark - 统一前缀
NSString *const kLZMediatorTarget_LZPatientManageComponent = @&quot;LZPatientManageComponent&quot;;

#pragma mark - 方法名称
NSString *const kLZMediatorAction_LuHealthRecordsView = @&quot;LuHealthRecordsView&quot;;        // 患者健康档案view

#pragma mark - block回调
NSString * const LZPatientManageComponent_HealthRecordsViewBlock = @&quot;HealthRecordsViewBlock&quot;;    // 患者健康档案block回调

@implementation LZMediator (LZPatientManageComponent)

/**
 创建患者健康档案实例

 @param pationModelDic 患者model字典
 @param prescriptionFlag 处方类型
 @param recoresViewBlock 患者健康档案的block回调
 @return 患者健康档案实例
 */
- (UIView *)LZPatientManageComponent_LuHealthRecordsView:(NSDictionary *)pationModelDic withPrescriptionFlag:(NSString *)prescriptionFlag withHealthRecordsViewBlock:(void (^)(NSDictionary *dic))recoresViewBlock
{
    NSMutableDictionary *params = [NSMutableDictionary dictionary];
    if (recoresViewBlock) {
        params[LZPatientManageComponent_HealthRecordsViewBlock] = recoresViewBlock;
        params[@&quot;pationModelDic&quot;] = pationModelDic;
        params[@&quot;prescriptionFlag&quot;] = prescriptionFlag;
    }

    UIView *healthRecordsView = [self performTarget:kLZMediatorTarget_LZPatientManageComponent action:kLZMediatorAction_LuHealthRecordsView params:params shouldCacheTarget:NO];
    if ([healthRecordsView isKindOfClass:[UIView class]]) {
        return healthRecordsView;
    }
    return [UIView new];
}

@end
</code></pre>
<p>这里主要将代理替换为 <strong>Block</strong> 以实现方法的回调。主要传递了三个参数，</p>
<ul>
<li><strong>pationModelDic</strong>，由于病例视图展示的数据是以 <strong>model</strong> 形式传递的，而中间件只能接收字典类型的参数，所以在调用方法前需要将 <strong>model</strong> 转化为 <strong>NSDictionary</strong></li>
<li><strong>prescriptionFlag</strong>，该参数为临时添加的参数，用于判断处方类型。</li>
<li><strong>recoresViewBlock</strong>，患者健康档案 <strong>block</strong> 回调，针对视图 <strong>show</strong> 之后的各种附加处理，如，网络请求，存储返回值。</li>
</ul>
<p>这里需要在最终需要调用的患者病历视图类 (<strong>LuHealthRecordsView</strong>) 中增加对应的 <strong>Block</strong> 方法，当操作 <strong>LuHealthRecordsView</strong> 的实例触发视图上的事件时会有结果值回调。（这一步正是替代了原有的两个功能组件间用于交互的代理方法）。具体如下：</p>
<p>在 <strong>LuHealthRecordsView.h</strong> 中声明，</p>
<pre><code class="objectivec">typedef void (^HealthRecordBlock)(NSDictionary *dic);   // 用于返回病史/过敏史的block回调(主要应用于患者中间件的传值)

@property (nonatomic, copy) HealthRecordBlock healthRecordBlock;
</code></pre>
<p>在 <strong>LuHealthRecordsView.m</strong> 中触发回调，</p>
<pre><code class="objectivec">- (void)sureBtnClick
{
    NSDictionary *recordsDic = @{@&quot;buttonType&quot;: @&quot;1&quot;,
                                 @&quot;userTag&quot;: [NSNumber numberWithInteger:self.userTag],
                                 @&quot;illHistory&quot;: self.contentView2.view1.textView.text,
                                 @&quot;allergicHistory&quot;: self.contentView2.view2.textView.text
                                 };
    self.healthRecordBlock(recordsDic);
}
</code></pre>
<p>这里同样是以字典方式返回操作结果，这也是组件化中很重要的一个点 —- <strong>去 model 化</strong>。</p>
<p>在这里还要提一个点，这个大的 <strong>Action</strong> 方法的调用，传入的所有参数都需要与实际要调用的视图一一对应。也就是说用到什么参数，就在该方法中增加什么参数。</p>
<p>患者管理组件（<strong>LZPatientManageComponent</strong>）中，<strong>Target</strong> 目录下处理调用类实例方法，在类 <strong>Target_LZPatientManageComponent</strong> 对应方法下实现，如下：</p>
<p>在 <strong>Target_LZPatientManageComponent.m</strong> 中</p>
<pre><code class="objectivec">/**
 返回LuHealthRecordsView视图
 */
- (UIView *)Action_LuHealthRecordsView:(NSDictionary *)param
{
    LuHealthRecordsView *healthRecordsView = [[LuHealthRecordsView alloc] initWithFrame:CGRectMake(106/2, 70, SCREEN_WIDTH - 106, SCREEN_HEIGHT - 140)];
    NSDictionary *pationModelDic = param[@&quot;pationModelDic&quot;];
    PationModel *pationModel = [[PationModel alloc] init];
    [pationModel setValuesForKeysWithDictionary:pationModelDic];
    healthRecordsView.model = pationModel;
    healthRecordsView.prescriptionFlag = param[@&quot;prescriptionFlag&quot;];
    [healthRecordsView showMe];

    healthRecordsView.healthRecordBlock = param[@&quot;HealthRecordsViewBlock&quot;];

    return healthRecordsView;
}
</code></pre>
<p><strong>LuHealthRecordsView</strong> 为最终需要调用的视图类，在调用前需要将传过来的参数进行转化，</p>
<ul>
<li><strong>param[@”pationModelDic”]</strong> 转化为对应的 <strong>PationModel</strong></li>
<li><strong>param[@”prescriptionFlag”]</strong> 处方类型的标识</li>
<li>还有最为重要的一点，将 <strong>param[@”HealthRecordsViewBlock”]</strong> 的 <strong>block</strong> 赋给 <strong>healthRecordsView.healthRecordBlock</strong> 从而触发回调。</li>
</ul>
<p>最后，在工作台组件中调用患者管理中间件进行通讯，如下：</p>
<pre><code class="objectivec">NSDictionary *pationModelDic = self.patientModel.mj_keyValues;
    __weak typeof(self) weakSelf = self;
    UIView *healthRecordsView = [[LZMediator sharedInstance] LZPatientManageComponent_LuHealthRecordsView:pationModelDic withPrescriptionFlag:@&quot;3&quot; withHealthRecordsViewBlock:^(NSDictionary *dic) {

        NSString *buttonType = dic[@&quot;buttonType&quot;];
        weakSelf.illHistory = dic[@&quot;illHistory&quot;];
        weakSelf.allergicHistory = dic[@&quot;allergicHistory&quot;];

        if ([buttonType isEqualToString:@&quot;0&quot;]) {
            //键盘处理
//            [IQKeyboardManager sharedManager].enable = YES;
            [self.healthRecordsBgView removeFromSuperview];
            NSInteger userTag = [dic[@&quot;userTag&quot;] integerValue];
            if (userTag != 3) {
                [weakSelf savePatientHealthRecords];
            }

        } else if ([buttonType isEqualToString:@&quot;1&quot;]) {
            //键盘处理
//            [IQKeyboardManager sharedManager].enable = YES;
            [weakSelf savePatientHealthRecords];
            weakSelf.headerView.patientModel = weakSelf.patientModel;

        }
    }];
    [_healthbg addSubview:healthRecordsView];
</code></pre>
<p><strong>block</strong> 回调中处理了未进行组件化前代理方法的工作。最后，这里需要强调一个点，当用于通讯的中间件中需要新增与某个组件通讯的方法时，最好是遵循一个原则：</p>
<blockquote>
<p>谁污染谁治理，谁调用谁新增。</p>
</blockquote>
<p>即，哪个组件需要进行与其它组件通讯，则由有这个需要的组件的发起者，去他需要调用的组件的中间件中新增用于通讯的方法。</p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>涉及到项目组件化还有一些收尾工作：</p>
<ul>
<li>创建壳工程，配置App运行的基本环境</li>
<li>去除主工程 <strong>Assets.xcassets</strong> 目录下的多余资源文件(这些文件已抽到各个业务功能组件中)</li>
<li>组件化方案中的去 <strong>model</strong> 的设计</li>
<li>将各个功能模块中涉及到数据库组件，<strong>SQLite</strong> 的查询语句都移动到数据库组件中</li>
</ul>
<p>5月初开始对项目进行重构，原以为只要项目完成组件化，重构工作就顺理成章的结束了。但现在看来组件化不是重构的结束，仅仅是一个开始。在我看来以私有 <strong>pod</strong> 为形式的组件化，只是一种强制解除各个功能模块之间耦合度的方式。它将一个复杂的项目按功能拆分成不同 <strong>pod</strong> 库，不同组件之前想要通讯，只能通过中间件。因此，我认为组件化的本质是对代码结构的整理，它无形中制定了一套编码规范，迫使开发者在编写代码时不能随心所欲的按照自己的喜好堆放代码。</p>
<p>如果你一开始都注意代码规范，同时又时时留意该如果降低工程中功能间的耦合度。那么，完全没有必要进行组件化。</p>
<blockquote>
<p>组件化只是术，而非道。</p>
</blockquote>
<p>组件化只是项目重构的第一步，项目重构之路道阻且长，但行则必至。这里为了在后续的重构工作中提醒自己，同时，打个疫苗（希望这次打的是真疫苗）预防一下后续重构中可能会遇到的问题。翻译了一篇文章 — <a href="https://xibhe.com/2018/08/10/RebuildFlagsSignaling/" target="_blank" rel="external">重写代码会失败的几个征兆</a> 对比文章中的5个方面，结合正在开发的项目，希望有所帮助。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://casatwy.com/iosying-yong-jia-gou-tan-kai-pian.html" target="_blank" rel="external">iOS应用架构谈 开篇 - Casa Taloyum</a></p>
<p><a href="https://casatwy.com/iosying-yong-jia-gou-tan-viewceng-de-zu-zhi-he-diao-yong-fang-an.html" target="_blank" rel="external">iOS应用架构谈 view层的组织和调用方案 - Casa Taloyum</a></p>
<p><a href="https://casatwy.com/iosying-yong-jia-gou-tan-wang-luo-ceng-she-ji-fang-an.html" target="_blank" rel="external">iOS应用架构谈 网络层设计方案 - Casa Taloyum</a></p>
<p><a href="https://casatwy.com/iosying-yong-jia-gou-tan-ben-di-chi-jiu-hua-fang-an-ji-dong-tai-bu-shu.html" target="_blank" rel="external">iOS应用架构谈 本地持久化方案及动态部署 - Casa Taloyum</a></p>
<p><a href="https://casatwy.com/iOS-Modulization.html" target="_blank" rel="external">iOS应用架构谈 组件化方案 - Casa Taloyum</a></p>
<p><a href="https://github.com/casatwy/CTMediator" target="_blank" rel="external">CTMediator</a></p>
<p><a href="http://www.ximublog.cn/modularization/" target="_blank" rel="external">组件化方案调研</a></p>
<p><a href="https://blog.cnbluebox.com/blog/2015/11/28/module-and-decoupling/" target="_blank" rel="external">模块化与解耦</a></p>
<p><a href="https://git-scm.com/book/zh/v2/服务器上的-Git-GitLab" target="_blank" rel="external">服务器上的 Git - GitLab</a></p>
<p><a href="https://github.com/CocoaPods/CocoaPods/issues/4420" target="_blank" rel="external">XCode 7.1 - Include of non-modular header inside framework</a></p>
<p><a href="https://forums.developer.apple.com/thread/23554" target="_blank" rel="external">Include of non-modular header inside framework module</a></p>
<p><a href="https://github.com/CocoaPods/CocoaPods/issues/3511" target="_blank" rel="external">Reference to ‘enum_value’ is ambiguous</a></p>
<p><a href="https://github.com/AFNetworking/AFNetworking/issues/2205" target="_blank" rel="external">Make AFNetworking compatible for an iOS 8 Cocoa Touch Framework</a></p>
<p>–EOF–</p>
<p>若无特别说明，本站文章均为原创，转载请保留链接，谢谢</p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 Gitalk -->
<div id="gitalk-comment">
    <!-- Gitalk 评论框 -->
<div id="gitalk-container"></div>

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<script>
    var gitalk = new Gitalk({
            clientID: '664d164a7c2910ff9c32',
            clientSecret: '312260816c7af1b87c16b13906b55270ba8a1736',
            repo: 'BlogGitalks',
            owner: 'xibhe',
            admin: ['xibhe'],
            // facebook-like distraction free mode
            distractionFreeMode: false,
            // id: 'Wed Jul 18 2018 00:00:00 GMT+0800'
            // 解决因文章标题过长无法初始评论的问题
            id: (location.pathname).split("/").pop().substring(0, 49)
        })
   gitalk.render('gitalk-container')
</script>

</div>
<style>
    #gitalk-comment {
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2018/08/10/RebuildFlagsSignaling/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2018/05/28/Compiling/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.jpg);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.jpg" alt="XibHe's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        huahuaaihehe@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2020/08/">八月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/05/">五月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/05/">五月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/03/">三月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/01/">一月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/12/">十二月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/10/">十月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/08/">八月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/07/">七月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/05/">五月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/04/">四月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">三月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/02/">二月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">十一月 2017<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">九月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">八月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">一月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">十二月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">八月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/01/">一月 2016<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/JavaScript/">JavaScript<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/Objective-C/">Objective-C<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/categories/功能/">功能<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/探索/">探索<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/架构/">架构<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/解惑/">解惑<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/categories/设计模式/">设计模式<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/译文/">译文<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/categories/阅读/">阅读<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/随笔/">随笔<span class="sidebar_archives-count">8</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/quotes" title="引述">
                
                    <i class="material-icons sidebar-material-icons">star rate</i>
                
                引述
            </a>
        </li>
        
    
        <li>
            <a href="/tags" title="标签云">
                
                    <i class="material-icons sidebar-material-icons">search</i>
                
                标签云
            </a>
        </li>
        
    
        <li>
            <a href="/about" title="关于我">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                关于我
            </a>
        </li>
        
    
        <li>
            <a href="/links" title="友情链接">
                
                    <i class="material-icons sidebar-material-icons">link</i>
                
                友情链接
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/heheaihuahua" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/profile.php?id=100010683492211" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/xibhe" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;2016&nbsp;-<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>XibHe's Blog
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?V/53wGualMuiPM3xoetD5Q==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>







    <!-- Busuanzi -->
    <script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



   <!-- GitTalk -->









<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.2 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
