<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.2 -->
    <script>
        window.materialVersion = "1.5.2"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">



    <link rel="dns-prefetch" href="https://busuanzi.ibruce.info"/>












    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            从一个数据量过多的优化说起 | 
        
        XibHe&#39;s Blog
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="爱苹果,爱生活。">
    <meta name="keywords" content="null,SQLite,性能优化">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?MKetZV3cUTfDxvMffaOezg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/tranquil-heart.min.css?ul3p9I9MsbOxK0L+BHzDDg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="XibHe&#39;s Blog">
    <meta name="msapplication-starturl" content="http://XibHe.github.io/2018/04/18/SQLOptimize/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="XibHe&#39;s Blog">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://XibHe.github.io/2018/04/18/SQLOptimize/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="从一个数据量过多的优化说起 | XibHe&#39;s Blog">
    <meta property="og:image" content="/img/favicon.png">
    <meta property="og:description" content="爱苹果,爱生活。">
    <meta property="og:article:tag" content="SQLite"> <meta property="og:article:tag" content="性能优化"> 

    
        <meta property="article:published_time" content="Wed Apr 18 2018 00:00:00 GMT+0800">
        <meta property="article:modified_time" content="Sun Nov 11 2018 15:21:57 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://XibHe.github.io/2018/04/18/SQLOptimize/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://XibHe.github.io/2018/04/18/SQLOptimize/index.html",
    "headline": "从一个数据量过多的优化说起",
    "datePublished": "Wed Apr 18 2018 00:00:00 GMT+0800",
    "dateModified": "Sun Nov 11 2018 15:21:57 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "XibHe",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.jpg"
        },
        "description": "It is never too late，Just do it better."
    },
    "publisher": {
        "@type": "Organization",
        "name": "XibHe&#39;s Blog",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",SQLite,性能优化null",
    "description": "爱苹果,爱生活。",
}
</script>


    

    <!-- Analytics -->
    
    
        <script>
    var _hmt = _hmt || [];
    (function() {var hm = document.createElement('script');
    hm.src = 'https://hm.baidu.com/hm.js?919ef00558a82bb0e224f917f84d3124';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>

    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#更新说明"><span class="post-toc-number">1.</span> <span class="post-toc-text">更新说明</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#卡顿问题的解决"><span class="post-toc-number"></span> <span class="post-toc-text">卡顿问题的解决</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#方案一"><span class="post-toc-number">1.</span> <span class="post-toc-text">方案一:</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#方案二"><span class="post-toc-number">2.</span> <span class="post-toc-text">方案二:</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#方案三"><span class="post-toc-number">3.</span> <span class="post-toc-text">方案三:</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#方案四"><span class="post-toc-number">4.</span> <span class="post-toc-text">方案四</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#关于数据库查询语句的优化"><span class="post-toc-number"></span> <span class="post-toc-text">关于数据库查询语句的优化</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ONE-PIECE"><span class="post-toc-number"></span> <span class="post-toc-text">ONE PIECE</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#一个关于-CoreData-的问题"><span class="post-toc-number">1.</span> <span class="post-toc-text">一个关于 CoreData 的问题</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用Blob存储NSData遇到的问题"><span class="post-toc-number">2.</span> <span class="post-toc-text">使用Blob存储NSData遇到的问题</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#小结"><span class="post-toc-number"></span> <span class="post-toc-text">小结</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#后记"><span class="post-toc-number"></span> <span class="post-toc-text">后记</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#参考资料"><span class="post-toc-number"></span> <span class="post-toc-text">参考资料</span></a>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        <!-- Custom Thumbnail -->
        <div class="post_thumbnail-custom mdl-card__media mdl-color-text--grey-50" style="background-image:url(https://xibhe.oss-cn-beijing.aliyuncs.com/SQLDataOptimize_headerThumbnail.jpg)">
    
            <p class="article-headline-p">
                从一个数据量过多的优化说起
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.jpg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>XibHe</strong>
        <span>4月 18, 2018</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">devices other</i>
    <span class="visuallyhidden">devices other</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
    <li class="mdl-menu__item">在其它设备中阅读本文章</li>
    
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACbElEQVR42u3aQZICIQwFUO9/aecAjj0/ScOg9VhZVis8F4A/eTy/ejzw8PDw8PDw8PAO4z3i8csXvbz/7vnkm6ufejsXHh4e3hbeH1vtJa8w8QvmGtlbGx4eHt5OXm/K3pPXM/bWhoeHh3cyr7qUZLvP58XDw8P7RF4eQIwWioeHh3c8L/nDn0S6eRBcvZQvz1rw8PDwYl4eyO5/vbW+h4eHhxfwyi1NxTaCedls1HSFh4eHt4CXb8QJu/dt14dQ+YKOh4eHt5iXlPAnZa1qo0C+hiiMwMPDw1vAm2z6SQGsF8X2omQ8PDy8c3jVslYvlp0cKnh4eHg7eXnkWo1r8209fyd6Eg8PD28jL49cqwWt3nGSN7Di4eHh7edVi/rX01TbCPLjJGqcxcPDw1vM64WtSZk/B0SLnmQteHh4eMt4SfNTsrlX2wLy2ZutA3h4eHiLec94VItnvYg2p+Lh4eHt4eVX5/wa3SuMVQPcQusAHh4e3q28/Bqdb9x5dDsJI8oxLh4eHt5NvGq0Oi+P9Y6fwmGDh4eHt5g3KfPf1Z41WUmUteDh4eEt4+XRQF5C6wUZoys7Hh4e3nZeb7uvthT02hGaTVd4eHh4y3i9ktjkx+odLaN/DHh4eHhjXnX02gUmR0L5J8bDw8NbzKtuxPnFOmdMXpc7I/Dw8PBu4lWv1L0nk3arJQcDHh4e3jJete2pWqDqLT1vqMXDw8M7mVeNZctFrPgIwcPDw/sU3oQ9aS+4uTMCDw8Pb8xLtunrY6Aa104aYfHw8PD+lzdqcmpdwfP2rHLgi4eHh7eY930DDw8PDw8PDw/vgPEDUNTEcJ5+ltQAAAAASUVORK5CYII=">
    
</ul>

    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/SQLite/">SQLite</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/性能优化/">性能优化</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    
        
    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=从一个数据量过多的优化说起&url=http://XibHe.github.io/2018/04/18/SQLOptimize/index.html&pic=http://XibHe.github.io/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=从一个数据量过多的优化说起&url=http://XibHe.github.io/2018/04/18/SQLOptimize/index.html&via=XibHe" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://XibHe.github.io/2018/04/18/SQLOptimize/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=XibHe&#39;s Blog&title=从一个数据量过多的优化说起&summary=爱苹果,爱生活。&pics=http://XibHe.github.io/img/favicon.png&url=http://XibHe.github.io/2018/04/18/SQLOptimize/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>前段时间遇到一个问题，程序中查询患者信息的功能，当患者数据量超过 <strong>30000</strong> 条时，会出现卡顿，APP 无响应的问题。在处理这个需求时，需要将本地数据库中的全部患者数据查询出来，然后按照从 <strong>A - Z</strong> 的患者首字母进行分组排序。对于不属于 <strong>A - Z</strong> 的数据，将其分为 <strong>#</strong> 组。</p>
<h3 id="更新说明"><a href="#更新说明" class="headerlink" title="更新说明"></a>更新说明</h3><p>更新记录:</p>
<ul>
<li>2018 年 04 月，第一版。</li>
<li>2018 年 06 月，补充后续的优化方案。</li>
</ul>
<h2 id="卡顿问题的解决"><a href="#卡顿问题的解决" class="headerlink" title="卡顿问题的解决"></a>卡顿问题的解决</h2><p>原来的代码逻辑如下：</p>
<pre><code class="objectivec">// 全部患者数据
_allPatients = [[LZDatabaseHelper sharedInstance] getAllPatient];
NSMutableArray *tempArray = _allPatients.mutableCopy;
    for (char a = &#39;A&#39;; a &lt;=&#39;Z&#39;; a ++) {
        LZPatientListSectionModel *sectionModel = [[LZPatientListSectionModel alloc] init];
        sectionModel.sectionTitle = [NSString stringWithFormat:@&quot;%c&quot;,a];
        for (int i = 0; i &lt; _allPatients.count; i++) {
            PationMoedl *pationModel = _allPatients[i];
            if (pationModel.userShortName.length &gt; 0) {
                char temp = [pationModel.userShortName characterAtIndex:0];
                if (a == temp) {
                    [sectionModel.patientList addObject:pationModel];
                    [tempArray removeObject:pationModel];
                }
            }
        }
        if (sectionModel.patientList.count &gt;0) {
            [self.patientArray addObject:sectionModel];
        }
    }
    LZPatientListSectionModel *sectionModel = [[LZPatientListSectionModel alloc] init];
    sectionModel.sectionTitle = @&quot;#&quot;;
    if (tempArray.count &gt; 0) {
        [sectionModel.patientList addObjectsFromArray:tempArray];
        [self.patientArray insertObject:sectionModel atIndex:0];
    }
    [_patientTableView reloadData];
</code></pre>
<p>从上面的代码可以计算出排序的时间复杂度，第一个 <strong>for</strong> 循环执行 <strong>26</strong> 次，嵌套在内的第二个 <strong>for</strong> 循环会执行 <strong>30000</strong> 次。时间复杂度用大写字母 <strong>O</strong> 来表示，因此该排序的时间复杂度是:</p>
<font color="#e5622" size="5"> O(26 * 30000) </font>

<p>也就是说当点击对应的按钮查看患者后，会执行 <strong>780000</strong> 次 <strong>for</strong> 去遍历全部患者，并将符合首字母符合 <strong>A - Z</strong> 的患者添加到 <strong>sectionModel.patientList</strong> 数组中，然后刷新列表展示排好序的数据。这也是为什么会出现患者量少时没有问题，一但患者量达到上万条时就会出现点击对应按钮后，就会出现卡顿的问题。要解决这样的问题，需要从如何降低时间复杂度着手。</p>
<p>尝试了 <strong>4</strong> 种不同的方案，如下：</p>
<h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一:"></a>方案一:</h3><p>算法角度上，以空间换时间，一下子就创建好 26 个存放 A - Z 首字母排序的数组，以减少循环次数为目的，循环一次，找到对应首字母序列的数据，从数据源中移除这些数据；然后，继续开始下一次遍历，以此类推，直到查询出所有排序数组。（时间复杂度，空间复杂度）</p>
<ul>
<li><p>桶排序算法</p>
</li>
<li><p>快速排序算法</p>
</li>
</ul>
<h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二:"></a>方案二:</h3><p>几种不同遍历方式的比较，试图通过比较查询效率，找到最快的遍历方式。</p>
<ul>
<li>经典 for 循环</li>
<li>for in (NSFastEnumeration)</li>
<li>KVC 集合运算符 </li>
<li>enumerateObjectsUsingBlock</li>
<li>enumerateObjectsWithOptions(NSEnumerationConcurrent) </li>
</ul>
<p>初始化 <strong>100</strong> 个对象的遍历操作所消耗的时间(毫秒级): </p>
<ul>
<li>经典for循环 — 0.0023</li>
<li>for in (NSFastEnumeration) — 0.003090</li>
<li>makeObjectsPerformSelector — 0.001120</li>
<li>kvc集合运算符 — 0.004272</li>
<li>enumerateObjectsUsingBlock — 0.001145</li>
<li>enumerateObjectsWithOptions(NSEnumerationConcurrent) — 0.001605</li>
</ul>
<p>这样并不能看出什么结论，当初始化 <strong>1000000</strong> 个对象时就会有很大差距</p>
<ul>
<li>经典for循环 — 1.246721</li>
<li>for in (NSFastEnumeration) — 0.025955</li>
<li>makeObjectsPerformSelector — 0.068234</li>
<li>kvc集合运算符 — 21.677246</li>
<li>enumerateObjectsUsingBlock — 0.586034</li>
<li>enumerateObjectsWithOptions(NSEnumerationConcurrent) — 0.722548</li>
</ul>
<p>可以看出当数据量少时，<strong>for in</strong> 的速度并不突出，但当数量达到一定量级后，<strong>for in</strong> 的遍历速度就体现出来了。</p>
<h3 id="方案三"><a href="#方案三" class="headerlink" title="方案三:"></a>方案三:</h3><p>折中方案，为了避免查询时卡死主线程，将查询方法放在 <strong>异步线程</strong> 里，然后在 <strong>主线程</strong> 中刷新数据源。如下：</p>
<pre><code class="objectivec">dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^{

        for (char a = &#39;A&#39;; a &lt;=&#39;Z&#39;; a ++) {
            LZPatientListSectionModel *sectionModel = [[LZPatientListSectionModel alloc] init];
            sectionModel.sectionTitle = [NSString stringWithFormat:@&quot;%c&quot;,a];

            for (PationMoedl *pationModel in _allPatients) {
                // 根据数据库中的患者简称，将对应简称的model存入sectionModel.patientList中
                if (pationModel.userShortName.length &gt; 0) {
                    char temp = [pationModel.userShortName characterAtIndex:0];
                    if (a == temp) {
                        [sectionModel.patientList addObject:pationModel];
                        [tempArray removeObject:pationModel];
                    }
                }
            }
            if (sectionModel.patientList.count &gt;0) {
                [self.patientArray addObject:sectionModel];
            }
        }

        LZPatientListSectionModel *sectionModel = [[LZPatientListSectionModel alloc] init];
        sectionModel.sectionTitle = @&quot;#&quot;;
        if (tempArray.count &gt; 0) {
            [sectionModel.patientList addObjectsFromArray:tempArray];
            [self.patientArray insertObject:sectionModel atIndex:0];
        }

        dispatch_async(dispatch_get_main_queue(), ^{
            [_patientTableView reloadData];
            [MBProgressHUD hideHUDForView:self];
        });

});
</code></pre>
<h3 id="方案四"><a href="#方案四" class="headerlink" title="方案四"></a>方案四</h3><p>方案4也是最终采用的方案，主要时间排序的功能用 <strong>SQL</strong> 语句去实现，在每次遍历时，传入一个当前的序列，通过执行数据库查询语句得到一个分好的序列数组，这样就大大减少了 <strong>for</strong> 循环的次数，提高了速度。但为了不卡死线程，仍然需要与 <strong>GCD</strong> 结合起来使用。如下：</p>
<pre><code class="objectivec">[MBProgressHUD showMessag:@&quot;加载中&quot; toView:self];
// 1. 将整个查询的耗时操作放到 GCD 中
dispatch_sync(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
//  查询出所有患者数据，为搜索功能提供数据源
     _allPatients = [[LZDatabaseHelper sharedInstance] getAllPatientForIndexes];
     // 2. 从 A - Z 进行 26 次遍历
    for (char a = &#39;A&#39;; a &lt;=&#39;Z&#39;; a ++) {
        NSString *orderNumber = [NSString stringWithFormat:@&quot;%c&quot;,a];
        // 3. 通过 SQL 语句查出对应首字母序列的返回的数组
        NSArray *patientRankArray = [[LZDatabaseHelper sharedInstance] getPatientGroup:orderNumber];
        // 4. 将查询到的某一序列数组与分组名称进行绑定
        if (patientRankArray &amp;&amp; patientRankArray.count &gt; 0) {
            LZPatientListSectionModel *sectionModel = [[LZPatientListSectionModel alloc] init];
            sectionModel.sectionTitle = orderNumber;
            [sectionModel.patientList addObjectsFromArray:patientRankArray];
            [self.patientArray addObject:sectionModel];
        }
    }

        // 5. 通过 SQL 语句查出其他非 A-Z 的数据
        NSArray *otherArray = [[LZDatabaseHelper sharedInstance] getPatientMistakeGroup];

        // 6. 将查询到的非 A-Z 插入到患者数据源中
        if (otherArray &amp;&amp; otherArray.count &gt; 0) {
            LZPatientListSectionModel *sectionModel = [[LZPatientListSectionModel alloc] init];
            sectionModel.sectionTitle = @&quot;#&quot;;
            [sectionModel.patientList addObjectsFromArray:otherArray];
            [self.patientArray insertObject:sectionModel atIndex:0];
        }

        // 7. 主线程中刷新列表
        dispatch_async(dispatch_get_main_queue(), ^{
            [_patientTableView reloadData];
            [MBProgressHUD hideHUDForView:self];
        });

    });
</code></pre>
<p>具体步骤如下：</p>
<ol>
<li>将整个查询的耗时操作放到 GCD 中；</li>
<li>从 A - Z 进行 26 次遍历；</li>
<li>通过 SQL 语句查出对应首字母序列的返回的数组；</li>
<li>将查询到的某一序列数组与分组名称进行绑定；</li>
<li>通过 SQL 语句查出其他非 A-Z 的数据；</li>
<li>将查询到的非 A-Z 插入到患者数据源中；</li>
<li>主线程中刷新列表。</li>
</ol>
<p>这里将最为耗时的对应首字母遍历数据操作，通过 <strong>SQL</strong> 查询语句来实现。那么 <strong>SQL</strong> 语句的查询速度究竟如何呢？可以在处理 <strong>SQL</strong> 查询的方法里增加计算方法执行耗时的代码：</p>
<pre><code class="objectivec">// 记录开始时间，放在方法执行的最前面
NSDate *startDate = [NSDate date];

// 记录结束时间，放到方法执行结束的位置
NSDate *finishDate = [NSDate date];
NSTimeInterval interval = [finishDate timeIntervalSinceDate:startDate];
NSLog(@&quot;查询全部患者数据耗时: %f&quot;,interval);
</code></pre>
<p>返回的时间戳大概为 <strong>0.45</strong> 毫秒。</p>
<h2 id="关于数据库查询语句的优化"><a href="#关于数据库查询语句的优化" class="headerlink" title="关于数据库查询语句的优化"></a>关于数据库查询语句的优化</h2><ol>
<li>建立索引</li>
<li>不要把SQL语句写得太复杂</li>
<li>避免过度使用 Select * 查询所有数据 （实际使用时只需要某一个或几个字段）</li>
<li>统一 <strong>SQL</strong> 语句的写法 (主要区分大小写)</li>
<li><strong>REPLACE INTO</strong> 语句的使用<ul>
<li><em>REPLACE</em> 作用与 <em>INSERT</em> 完全一致，但如果旧表中的行具有相同的值作为一个新行 <em>PRIMARY KEY</em> 或 <em>UNIQUE</em> 索引，旧行插入新行之前删除。</li>
<li><em>REPLACE</em> 是一个 <em>MySQL</em> 扩展 <em>SQL</em> 标准。它要么插入要么先删除再插入。</li>
<li>注意，除非表有一个 <em>PRIMARY KEY</em> 或 <em>UNIQUE</em> 索引，否则使用 <em>REPLACE</em> 语句是没有意义的。</li>
</ul>
</li>
<li><p><strong>SQL</strong> 语句的拓展</p>
<ul>
<li><em>sqlite</em> 截取字符串前几位后再进行查询</li>
<li>在 <em>sqlite</em> 中使用 <em>regex</em> 进行查询</li>
<li><p>SUBSTR()，SQL 中的 substring 函数是用来抓出一个栏位资料中的其中一部分。这个函数的名称在不同的数据库中不完全一样：</p>
<blockquote>
<p>MySQL: SUBSTR( ), SUBSTRING( )<br>Oracle: SUBSTR( )<br>SQL Server: SUBSTRING( )</p>
</blockquote>
</li>
<li><p>upper()函数，将小写转化为大写；lower()函数，将大写转化为小写。</p>
</li>
</ul>
</li>
</ol>
<pre><code class="objectivec">// 根据 A - Z 进行分组查询
NSString *sql = [NSString stringWithFormat:@&quot;SELECT id, userName, userShortName, birthday, sex, phone, address FROM table_sickPerson WHERE clinicId = &#39;%@&#39; AND status like &#39;0&#39; AND isDelete like &#39;0&#39; AND SUBSTR(upper(userShortName),1,1) = &#39;%@&#39; &quot;,clinkId,orderNumber];
</code></pre>
<ul>
<li>GLOB 用来连接正则表达式的关键字</li>
</ul>
<pre><code class="objectivec">// 查询非 A - Z 的数据
NSString *sql = [NSString stringWithFormat:@&quot;SELECT id, userName, userShortName, birthday, sex, phone, address FROM table_sickPerson WHERE clinicId = &#39;%@&#39; AND status like &#39;0&#39; AND isDelete like &#39;0&#39; AND SUBSTR(upper(userShortName),1,1) GLOB &#39;[^A-Z]&#39; &quot;,clinkId];
</code></pre>
<p>之前没有在 <strong>SQLite</strong> 中使用过 <strong>regex</strong> 还以为不支持呢，最后几经波折，在官网上找到了对应的文档！</p>
<p><img src="https://xibhe.oss-cn-beijing.aliyuncs.com/SQLDataOptimize_thumbnail01.png" alt="SQLite官网"></p>
<h2 id="ONE-PIECE"><a href="#ONE-PIECE" class="headerlink" title="ONE PIECE"></a>ONE PIECE</h2><h3 id="一个关于-CoreData-的问题"><a href="#一个关于-CoreData-的问题" class="headerlink" title="一个关于 CoreData 的问题"></a>一个关于 CoreData 的问题</h3><p><strong>Core Data</strong> 是 <strong>iOS5</strong> 之后才出现的一个框架，本质上是对 <strong>SQLite</strong> 的一个封装，它允许按照实体-属性-值模型组织数据，并以 <strong>XML</strong>，二进制文件或<strong>SQLite</strong> 数据文件的格式将其序列化。<strong>Core Data</strong> 允许用户使用代表实体和实体间关系的高层对象来操作数据。它也可以管理序列化的数据，提供对象生存期管理与 <strong>object graph</strong> 管理，包括存储。<strong>Core Data</strong> 直接与 <strong>SQLite</strong> 交互，避免开发者使用原本的 <strong>SQL</strong> 语句。</p>
<p>这里在尝试使用 <strong>Core Data</strong> 时遇到一个问题，在获取模型路径，创建模型对象时，一直报错：</p>
<pre><code class="objectivec">    NSURL *modelURL = [[NSBundle mainBundle] URLForResource:@&quot;testModel&quot; withExtension:@&quot;momd&quot;];
    _managedObjectModel = [[NSManagedObjectModel alloc] initWithContentsOfURL:modelURL];
    return _managedObjectModel;
</code></pre>
<pre><code class="objectivec"> *** Terminating app due to uncaught exception &#39;NSInvalidArgumentException&#39;, reason: &#39;CoreData: Cannot load NSManagedObjectModel.  nil is an illegal URL parameter&#39;
</code></pre>
<p><strong>Core Data</strong> 数据库的名字和封装类里的名字是一致的。</p>
<h3 id="使用Blob存储NSData遇到的问题"><a href="#使用Blob存储NSData遇到的问题" class="headerlink" title="使用Blob存储NSData遇到的问题"></a>使用Blob存储NSData遇到的问题</h3><p>先通过 <em>UPDATE</em> 语句更新数据，</p>
<pre><code class="objectivec">// 更新faceFeatureData
+ (void)updateFaceFeatureData:(NSData *)faceFeatureData
{
    FMDatabase *dataBase = [ConfigurateDB open];
    [dataBase beginTransaction];

    NSString *sql = [NSString stringWithFormat:@&quot;UPDATE Register SET faceFeatureData = &#39;%@&#39; WHERE id = &#39;1&#39;&quot;,faceFeatureData];
    [dataBase executeUpdate:sql];

    [dataBase commit];
}
</code></pre>
<p>再通过 <em>SELECT</em> 获取更新的值。</p>
<pre><code class="objectivec">// 获取个人信息
+ (AFRPerson *)getInformationWithUserID:(NSInteger)Id
{
    FMDatabase *dataBase = [ConfigurateDB open];
    NSString *sql = [NSString stringWithFormat:@&quot;SELECT * FROM Register WHERE id = &#39;%ld&#39;&quot;,Id];
    FMResultSet * resultSet = [dataBase executeQuery:sql];
    AFRPerson *person = nil;
    while ([resultSet next]) {
        person = [[AFRPerson alloc] init];

        person.Id = [resultSet intForColumn:@&quot;id&quot;];
        person.faceID  = [resultSet intForColumn:@&quot;faceID&quot;];
        person.faceFeatureData = [resultSet dataForColumn:@&quot;faceFeatureData&quot;];
        person.name = [resultSet stringForColumn:@&quot;name&quot;];
        person.attendanceStatus = [resultSet stringForColumn:@&quot;attendanceStatus&quot;];
    }

    [resultSet close];

    return person;
}
</code></pre>
<p>发现 <em>person.faceFeatureData</em> 这个 <em>NSData</em> 类型的属性值，更新前与更新后再次获取的字节长度不一致，前者为：22020 bytes，后者为：48096 bytes。正常结果二者应是一致的。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><ul>
<li>第一手资料永远是官方文档！！！</li>
<li>算法真的真的很重要! ! !</li>
<li>很多性能问题，首先可以先从算法角度进行思考；</li>
<li>使用 <strong>GCD</strong> 多线程技术来处理耗时任务；</li>
<li>算法，不同遍历方式进行比较，<strong>SQL</strong>查询语句的优化，<strong>GCD</strong> 这几种方式相结合总能给人意想不到的惊喜，没有一种解决方案是孤立存在的。</li>
</ul>
<p>对症下药吧！将提高查询效率和减少遍历次数二者相结合。做完这次优化后，还是想问一句：这是最优的方案吗？还可以进一步优化吗? </p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>最后，这种方式虽然可以缓解数据量达到 <em>30000</em> 条时的卡顿状况。但打开列表页面时，仍然会 <em>loading</em> 两三秒， 最终处理方案是：当数据量大于 <em>5000</em> 条时，进行分页加载，一次加载 <em>200</em> 条，此时就没有必要将数据按首字母缩写排序了，可通过搜索框搜索出对应患者；当数据量小于 <em>5000</em> 时，仍保持之前的逻辑。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="http://www.sqlite.org/search?s=d&amp;q=regexp" target="_blank" rel="external">sqlite.org Documentation</a></p>
<p><a href="https://www.w3cschool.cn/sql/7vn4tfq0.html" target="_blank" rel="external">w3cschool SQL</a></p>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/replace.html" target="_blank" rel="external">13.2.9 REPLACE Syntax</a></p>
<p><a href="https://stackoverflow.com/questions/7793488/regex-in-sqlite-and-objectivec" target="_blank" rel="external">Regex in SQLite and ObjectiveC</a></p>
<p><a href="https://zh.wikipedia.org/wiki/Core_Data" target="_blank" rel="external">Core Data</a></p>
<p>–EOF–</p>
<p>若无特别说明，本站文章均为原创，转载请保留链接，谢谢</p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 Gitalk -->
<div id="gitalk-comment">
    <!-- Gitalk 评论框 -->
<div id="gitalk-container"></div>

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<script>
    var gitalk = new Gitalk({
            clientID: '664d164a7c2910ff9c32',
            clientSecret: '312260816c7af1b87c16b13906b55270ba8a1736',
            repo: 'BlogGitalks',
            owner: 'xibhe',
            admin: ['xibhe'],
            // facebook-like distraction free mode
            distractionFreeMode: false,
            id: 'Wed Apr 18 2018 00:00:00 GMT+0800'
        })
   gitalk.render('gitalk-container')
</script>

</div>
<style>
    #gitalk-comment {
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2018/05/28/Compiling/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2018/03/18/RunLoopAnalysis/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.jpg);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.jpg" alt="XibHe's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        huahuaaihehe@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2020/08/">八月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/05/">五月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/05/">五月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/03/">三月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/01/">一月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/12/">十二月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/10/">十月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/08/">八月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/07/">七月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/05/">五月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/04/">四月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">三月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/02/">二月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">十一月 2017<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">九月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">八月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">一月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">十二月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">八月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/01/">一月 2016<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/JavaScript/">JavaScript<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/Objective-C/">Objective-C<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/categories/功能/">功能<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/探索/">探索<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/架构/">架构<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/解惑/">解惑<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/categories/设计模式/">设计模式<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/译文/">译文<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/categories/阅读/">阅读<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/随笔/">随笔<span class="sidebar_archives-count">8</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/quotes" title="引述">
                
                    <i class="material-icons sidebar-material-icons">star rate</i>
                
                引述
            </a>
        </li>
        
    
        <li>
            <a href="/tags" title="标签云">
                
                    <i class="material-icons sidebar-material-icons">search</i>
                
                标签云
            </a>
        </li>
        
    
        <li>
            <a href="/about" title="关于我">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                关于我
            </a>
        </li>
        
    
        <li>
            <a href="/links" title="友情链接">
                
                    <i class="material-icons sidebar-material-icons">link</i>
                
                友情链接
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/heheaihuahua" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/profile.php?id=100010683492211" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/xibhe" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;2016&nbsp;-<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>XibHe's Blog
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?V/53wGualMuiPM3xoetD5Q==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>







    <!-- Busuanzi -->
    <script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



   <!-- GitTalk -->









<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.2 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
